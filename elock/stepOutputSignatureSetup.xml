<?xml version="1.0" encoding="UTF-8"?>
<dynaForm name="SigplusSigners" width="450" mode="edit" enableTemplate="0" border="0">

<title1 type="title" >
  <en>Output Document to be signed</en>
</title1>

<PRO_UID type="hidden" showInTable="0" />
<TAS_UID type="hidden" showInTable="0" />
<STP_UID type="hidden" showInTable="0" />

<DOC_UID type="dropdown" style="width:250px" sqlConnection="dbarray">
    SELECT * FROM docList
   <en>Documents List</en>
</DOC_UID>

<SIGNERS_TITLE type="title" enablehtml="0">
  <en>Signers Names</en>
</SIGNERS_TITLE>



<SIGNERS_GRID type="grid" xmlgrid="sigplus/sigplusSignersNameGrid" addrow="1" deleterow="1">
</SIGNERS_GRID>

<BTN_SUBMIT type="submit" >
  <en>save</en>
</BTN_SUBMIT>



<JS type="JavaScript">
<![CDATA[
var _oVarsPanel_;
var previousRange;

leimnud.event.add(getField('INSERT_VARIABLE'), 'mouseover', function() {
  if(document.getElementsByTagName('iframe')[3]!=null){
    previousRange = document.getElementsByTagName('iframe')[3].contentWindow.document.selection.createRange();
  }
});

var showDynaformsFormVars = function(sFieldName, sAjaxServer, sProcess, sSymbol) {

    _oVarsPanel_ = new leimnud.module.panel();
    _oVarsPanel_.options = {
    limit    : true,
    size     : {w:400,h:600},
    position : {x:0,y:0,center:true},
    title    : '',
    theme    : 'processmaker',
    statusBar: false,
    control  : {drag:false,resize:true,close:true},
    fx       : {opacity:true,rolled:false,modal:true}
  };
  _oVarsPanel_.make();
  _oVarsPanel_.events = {
    remove:function() {
      delete _oVarsPanel_;
    }.extend(this)
  };
  _oVarsPanel_.loader.show();
  oRPC = new leimnud.module.rpc.xmlhttp({
    url   : sAjaxServer,
    method: 'POST',
    args  : 'sFieldName=' + sFieldName + '&sProcess=' + sProcess + '&sSymbol=' + sSymbol + '&sType=2'
  });
  oRPC.callback = function(oRPC) {
    _oVarsPanel_.loader.hide();
    var scs = oRPC.xmlhttp.responseText.extractScript();
    _oVarsPanel_.addContent(oRPC.xmlhttp.responseText);
    scs.evalScript();
  }.extend(this);
  oRPC.make();
};

/*
 *
 * @function insertFormVar
 * @author  unknow
 * @modifier Gustavo Cruz
 * @parameter sElementName Selection Area
 * @parameter sValue Data that mut be inserted
 * @sumary  This function is a variant of the original insertForm
 *          it works exclusively with the htmlarea editor or perhaps
 *          with some iframe based editors, it pass a sValue o symbol to insert.
 *          The sFieldName is deprecated.
 *          Takes the cursor position and replace the selected
 *          text with the symbol o case variable.
 *          then removes the panel
 *
 */

var insertFormVar = function(sElementName, sValue) {
//alert(previousRange.text);

        var userSelection;
	var myIFrame = document.getElementsByTagName('iframe')[0];
        if (document.getElementsByTagName('iframe')[3]){
            var myIFrameIE = document.getElementsByTagName('iframe')[3];
        }
    if (myIFrame.contentWindow.getSelection) {

      userSelection = myIFrame.contentWindow.getSelection();
      var test = document.createElement("span");
      test.innerHTML = sValue;
      range = myIFrame.contentWindow.getSelection().getRangeAt(0);
      range.deleteContents();
      range.insertNode(test);

    }else if (myIFrameIE.contentWindow.document.selection) {

      var test = document.createElement("span");
      test.innerHTML = sValue + " ";

      if(userSelection = myIFrameIE.contentWindow.document.selection.createRange()){

        if(userSelection.text==""){
          previousRange.pasteHTML(test.outerHTML);
        }else{

          userSelection.pasteHTML(test.outerHTML);
        }

      }

  }
  _oVarsPanel_.remove();
};



]]></JS>

</dynaForm>
var Base=function(a){var b={id:a&&a.id||jCore.Utils.generateUniqueId()};$.extend(!0,b,a);this.id=b.id};Base.prototype.setId=function(a){this.id=a;return this};Base.prototype.type="Core";Base.prototype.family="Core";Base.prototype.getType=function(){return this.type};Base.prototype.getFamily=function(){return this.family};Base.prototype.dispose=function(){for(var a in this)this[a]=null};
Base.prototype.generateUniqueId=function(){var a=function(a,b){"undefined"===typeof a&&(a=0);"undefined"===typeof b&&(b=999999999);return Math.floor(Math.random()*(b-a+1))+a},b=function(a,b){"undefined"===typeof a&&(a="");var c,g=function(a,b){var c="",d;a=parseInt(a,10).toString(16);if(b<a.length)return a.slice(a.length-b);if(b>a.length){c="";for(d=0;d<1+(b-a.length);d+=1)c+="0";return c+a}return a};this.php_js||(this.php_js={});this.php_js.uniqidSeed||(this.php_js.uniqidSeed=Math.floor(123456789*
Math.random()));this.php_js.uniqidSeed+=1;c=a+g(parseInt((new Date).getTime()/1E3,10),8);c+=g(this.php_js.uniqidSeed,5);b&&(c+=(10*Math.random()).toFixed(8).toString());return c},c;do c=b(a(0,999999999),!0),c=c.replace(".","0");while(32!==c.length);return c};
var getRelativePosition=function(a,b){var c=$(a).offset(),d=$(b).get(0)instanceof Document?{top:0,left:0}:$(b).offset();return{top:c.top-d.top,left:c.left-d.left}},Element=function(a){Base.call(this,a);this.zOrder=this.visible=this.style=this.html=this.height=this.width=this.y=this.x=null;Element.prototype.initObject.call(this,a)};Element.prototype=new Base;Element.prototype.type="Base";Element.prototype.family="Base";
Element.prototype.initObject=function(a){var b={id:a&&a.id||jCore.Utils.generateUniqueId(),style:{cssProperties:{},cssClasses:[]},width:0,height:0,x:0,y:0,zOrder:1,visible:!0};$.extend(!0,b,a);this.setId(b.id).setStyle(new jCore.Style({belongsTo:this,cssProperties:b.style.cssProperties,cssClasses:b.style.cssClasses})).setDimension(b.width,b.height).setPosition(b.x,b.y).setZOrder(b.zOrder).setVisible(b.visible)};Element.prototype.setId=function(a){this.id=a;this.html&&(this.html.id=this.id);return this};
Element.prototype.setX=function(a){if("number"===typeof a)this.x=a,this.html&&this.style.addProperties({left:this.x});else throw Error("setX: x param is not a number");return this};Element.prototype.setY=function(a){if("number"===typeof a)this.y=a,this.html&&this.style.addProperties({top:this.y});else throw Error("setY: y param is not a number");return this};
Element.prototype.setWidth=function(a){if("number"===typeof a)this.width=a,this.html&&this.style.addProperties({width:this.width});else throw Error("setWidth: w is not a number");return this};Element.prototype.setHeight=function(a){if("number"===typeof a)this.height=a,this.html&&this.style.addProperties({height:this.height});else throw Error("setHeight: h is not a number");return this};Element.prototype.setPosition=function(a,b){this.setX(a);this.setY(b);return this};
Element.prototype.setDimension=function(a,b){this.setWidth(a);this.setHeight(b);return this};Element.prototype.setZOrder=function(a){"number"===typeof a&&0<a&&(this.zOrder=a,this.html&&this.style.addProperties({zIndex:this.zOrder}));return this};Element.prototype.setVisible=function(a){_.isBoolean(a)&&(this.visible=a,this.html&&(a?this.style.addProperties({display:"inline"}):this.style.addProperties({display:"none"})));return this};
Element.prototype.setStyle=function(a){a instanceof jCore.Style&&(this.style=a);return this};Element.prototype.createHTMLElement=function(a){return document.createElement(a)};Element.prototype.createHTML=function(){this.html||(this.html=this.createHTMLElement("div"),this.html.id=this.id,this.style.applyStyle(),this.style.addProperties({position:"absolute",left:this.x,top:this.y,width:this.width,height:this.height,zIndex:this.zOrder}));return this.html};Element.prototype.paint=function(){};
Element.prototype.getHTML=function(){this.html||this.createHTML();return this.html};Element.prototype.calculateWidth=function(a,b){var c=b||"12px arial",c=$("<div>"+a+"</div>").css({position:"absolute","float":"left","white-space":"nowrap",visibility:"hidden",font:c}).appendTo($("body")),d=c.width();c.remove();return d};
var Tooltip=function(a,b){Element.call(this,a);this.hoverClass=this.hoverParent=this.messageObject=this.parent=this.message=this.css=this.icon=null;Tooltip.prototype.initObject.call(this,a,b)};Tooltip.prototype=new Element;Tooltip.prototype.type="Tooltip";Tooltip.prototype.family="Tooltip";Tooltip.prototype.initObject=function(a,b){var c={message:null,icon:"adam-tooltip-icon-default",css:"",parent:b||null,hoverParent:!0,hoverClass:"hovered"};$.extend(!0,c,a);this.setIcon(c.icon).setMessage(c.message).setParent(c.parent).setCss(c.css).setHoverClass(c.hoverClass).setHoverParent(c.hoverParent)};
Tooltip.prototype.setIcon=function(a){this.icon=a;return this};Tooltip.prototype.setMessage=function(a){this.message=a;return this};Tooltip.prototype.setParent=function(a){this.parent=a;return this};Tooltip.prototype.setCss=function(a){this.css=a;return this};Tooltip.prototype.setHoverParent=function(a){this.hoverParent=a;return this};Tooltip.prototype.setHoverClass=function(a){this.hoverClass=a;return this};
Tooltip.prototype.createHTML=function(){var a,b;b=this.createHTMLElement("a");b.href="#";b.className="adam-tooltip "+this.css;a=this.createHTMLElement("span");a.className=this.icon;b.appendChild(a);this.html=b;this.attachListeners();return this.html};Tooltip.prototype.attachListeners=function(){var a=this;$(this.html).mouseover(function(b){b.stopPropagation();a.show(b.pageX,b.pageY)}).mouseout(function(b){b.stopPropagation();a.hide()})};
Tooltip.prototype.show=function(a,b){var c;this.messageObject||(c=this.createHTMLElement("div"),c.className="adam-tooltip-message",c.innerHTML=this.message,c.style.position="absolute",c.style.top=b+10+"px",c.style.left=a+10+"px",c.style.zIndex=1E3,this.messageObject=c);document.body.appendChild(this.messageObject);this.hoverParent&&this.parent&&$(this.parent.html).addClass(this.hoverClass)};
Tooltip.prototype.hide=function(){document.body.removeChild(this.messageObject);this.messageObject=null;this.hoverParent&&this.parent&&$(this.parent.html).removeClass(this.hoverClass)};
var Field=function(a,b){Element.call(this,a);this.value=this.label=this.parent=null;this.validators=[];this.initialValue=this.messageError=this.required=this.name=null;this.requiredFailed=!1;this.proxy=this.submit=this.readOnly=this.change=this.controlObject=this.errorTooltip=this.helpTooltip=this.fieldWidth=null;Field.prototype.initObject.call(this,a,b)};Field.prototype=new Element;Field.prototype.type="Field";Field.prototype.family="Field";
Field.prototype.initObject=function(a,b){var c={required:!1,label:"",validators:[],value:null,messageError:null,initialValue:null,fieldWidth:null,helpTooltip:null,change:function(){},readOnly:!1,submit:!0,proxy:null};$.extend(!0,c,a);this.setParent(b);this.setRequired(c.required).setLabel(c.label).setName(c.name||this.type+"_"+this.id).setValidators(c.validators).setMessageError(c.messageError).setInitialValue(c.initialValue).setFieldWidth(c.fieldWidth).setHelpTooltip(c.helpTooltip).setErrorTooltip({}).setChangeHandler(c.change).setReadOnly(c.readOnly).setSubmit(c.submit).setProxy(c.proxy).setValue(c.value)};
Field.prototype.setRequired=function(a){this.required=a;return this};Field.prototype.setValue=function(a,b){this.value=b?a:a||this.initialValue;this.html&&this.controlObject&&(this.controlObject.value=this.value);this.proxy&&this.load();return this};Field.prototype.setName=function(a){this.name=a;return this};Field.prototype.setLabel=function(a){this.label=a;return this};
Field.prototype.setValidators=function(a){var b;for(b=0;b<a.length;b+=1)a[b]&&a[b].family&&"Validator"===a[b].family?this.validators.push(a[b]):this.validators.push(this.validatorFactory(a[b]));return this};Field.prototype.setMessageError=function(a){this.messageError=a;return this};Field.prototype.setParent=function(a){this.parent=a;return this};Field.prototype.setInitialValue=function(a){this.initialValue=a;return this};Field.prototype.setFieldWidth=function(a){this.fieldWidth=a;return this};
Field.prototype.setHelpTooltip=function(a){a?(a.css||(a.css="adam-tooltip-help"),this.helpTooltip=new Tooltip(a,this)):this.helpTooltip=null;return this};Field.prototype.setErrorTooltip=function(a){a?(a.css||(a.css="adam-tooltip-error-off"),a.icon||(a.icon="adam-tooltip-icon-error"),a.visible=!1,this.errorTooltip=new Tooltip(a,this)):this.errorTooltip=null;return this};Field.prototype.setChangeHandler=function(a){this.change=a;return this};
Field.prototype.setReadOnly=function(a){this.readOnly=a;this.html&&(this.controlObject.disabled=a);return this};Field.prototype.setSubmit=function(a){this.submit=a;return this};Field.prototype.setProxy=function(a){this.proxy=a;return this};
Field.prototype.validatorFactory=function(a){var b=null,c={email:{pattern:/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,message:"You must enter a valid email"},integer:{pattern:/^\s*(\+|-)?\d+\s*$/,message:"You must enter an integer"},required:{pattern:/\S/,message:"This field is required"}};if(a&&a.jtype)switch(a.jtype){case "required":a.criteria&&!a.criteria.trim&&(b=new TextLengthValidator({criteria:{trim:!1,
minLength:1},errorMessage:a.errorMessage||"this field is required"},this));break;case "email":case "integer":a.criteria=c[a.jtype].pattern;b=new RegExpValidator($.extend({errorMessage:c[a.jtype].message},a),this);break;case "comparison":b=new ComparisonValidator($.extend({errorMessage:"The comparison failed"},a),this);break;case "regexp":b=new RegExpValidator($.extend({errorMessage:"The pattern text didn't match with the specified one"},a),this);break;case "textLength":b=new TextLengthValidator($.extend({errorMessage:"The text length must be "},
a),this);break;case "custom":b=new CustomValidator($.extend({errorMessage:""},a),this);break;case "number":b=new NumberValidator($.extend({errorMessage:""},a),this);break;case "range":b=new RangeValidator($.extend({errorMessage:""},a),this);break;default:b=new Validator($.extend({errorMessage:""},a),this)}else b=new Validator(null,this);return b};Field.prototype.getObjectValue=function(){var a={};this.submit&&(a[this.name]=this.value);return a};
Field.prototype.evalRequired=function(){var a=!0;this.required&&((a=null!==this.value&&""!==this.value)?$(this.controlObject).removeClass("required"):$(this.controlObject).addClass("required"));return a};Field.prototype.reset=function(){this.setValue(this.initialValue||null,!0);this.errorTooltip&&($(this.errorTooltip.html).removeClass("adam-tooltip-error-on"),$(this.errorTooltip.html).addClass("adam-tooltip-error-off"));this.required&&this.controlObject&&$(this.controlObject).removeClass("required")};
Field.prototype.attachListeners=function(){};Field.prototype.createHTML=function(){Element.prototype.createHTML.call(this);this.style.removeProperties("position width height top left z-index".split(" "));this.style.addClasses(["adam-field"]);return this.html};
Field.prototype.isValid=function(){var a,b=!0;for(a=0;a<this.validators.length;a+=1)if(b=b&&this.validators[a].isValid(),!b)return this.errorTooltip.setMessage(this.validators[a].getErrorMessage()),$(this.errorTooltip.html).removeClass("adam-tooltip-error-off"),$(this.errorTooltip.html).addClass("adam-tooltip-error-on"),b;b&&($(this.errorTooltip.html).removeClass("adam-tooltip-error-on"),$(this.errorTooltip.html).addClass("adam-tooltip-error-off"));return b};
Field.prototype.onChange=function(){this.required&&this.evalRequired();this.isValid();this.change&&this.change(this);return this};Field.prototype.doLoad=function(){this.proxy&&this.load()};Field.prototype.load=function(){};
var EasySelector=function(a){this.existingValue=this.listMaxHeight=this.listHtmlBackup=this.isOpenSettings=this.isOpen=this.dom=this.html=this.value=this.label=this.id=null;this.settingOptions=[];this.width=null;this.options=[];this.htmlCreationProcessFinished=this.onSettingValueChange=this.settingValue=this.configurable=this.onChange=null;EasySelector.prototype.init.call(this,a)};
EasySelector.prototype.init=function(a){var b={options:[],listMaxHeight:200,width:240,settingOptions:[],configurable:!0,settingValue:null,onSettingValueChange:null,onChange:null,id:Math.floor(1E16*Math.random())};this.isOpenSettings=this.isOpen=!1;this.dom={};this.existingValue=!1;$.extend(!0,b,a);this.onSettingValueChange=b.onSettingValueChange;this.onChange=b.onChange;this.id=b.id;this.htmlCreationProcessFinished=!1;this.setOptions(b.options).setListMaxHeight(b.listMaxHeight).setWidth(b.width).setSettingOptions(b.settingOptions).setIsConfigurable(b.configurable).setSettingValue(b.settingValue)};
EasySelector.prototype.setIsConfigurable=function(a){this.configurable=!!a;this.html&&(a?($(this.dom.settings).show(),$(this.dom.arrow).css("right","")):(this.closeSettings(),$(this.dom.settings).hide(),$(this.dom.arrow).css("right","0px")),this.setWidth(this.width));return this};
EasySelector.prototype.setWidth=function(a){var b,c,d;"number"===typeof a?(this.width=a,b=a+"px"):parseInt(a,10)&&(b=this.width=a);this.html&&b&&(c=$(this.dom.input),$(this.html).css("width",b),/^\d+(\.\d+)*%$/.test(b)?c.css("width",""):(b=$(this.html).css("width",b).width(),this.html.parentElement?a=$(this.dom.arrow).outerWidth()+(this.configurable?$(this.dom.settings).outerWidth():0)+1:(d=this.html.cloneNode(!0),d.style.display="none",document.body.appendChild(d),a=$(d).find(".easyselector-arrow").outerWidth()+
(this.configurable?$(d).find(".easyselector-conf").outerWidth():0)+1,b=$(d).width(),$(d).remove()),b=b-a-(c.outerWidth()-c.width()),c.css("width",Math.floor(b)+"px")));return this};EasySelector.prototype.setSettingOptions=function(a){var b,c,d=!1;this.settingOptions=a;if(this.html){$(this.dom.settingOptions).empty();for(b=0;b<a.length;b++)c=this.createHTMLOption(a[b].label,a[b].value),a[b].selected&&(d=!0,$(c).addClass("selected")),this.dom.settingsPanel.appendChild(c);!d&&b&&$(this.dom.settingsPanel.childNodes[0]).addClass("selected")}return this};
EasySelector.prototype.setListMaxHeight=function(a){"number"===typeof a&&(this.listMaxHeight=a,this.html&&$(this.dom.list).css("max-height",a+"px"));return this};EasySelector.prototype.createHTMLOption=function(a,b){var c,d;c=document.createElement("li");d=document.createElement("a");d.appendChild(document.createTextNode(a));d.setAttribute("data-value",b);d.href="#";c.appendChild(d);return c};
EasySelector.prototype.addOption=function(a,b,c){this.options.push({label:a,value:b});this.html&&(this.dom.list.appendChild(this.createHTMLOption(a,b)),c&&this.setSelectedItem(a,b),this.listHtmlBackup=this.dom.list.cloneNode(!0));return this};
EasySelector.prototype.setOptions=function(a,b){var c;if(a.hasOwnProperty("length")&&a.push)if(this.html&&$(this.dom.list).empty(),b){if(this.html)for(c=0;c<this.listHtmlBackup.childNodes.length;c++)this.dom.list.appendChild(this.listHtmlBackup.childNodes[c].cloneNode(!0))}else{this.options=[];for(c=0;c<a.length;c++)this.addOption(a[c].label,a[c].value,a[c].selected)}return this};
EasySelector.prototype.processCurrentInput=function(){var a,b;if(this.html&&(a=$.trim(this.dom.input.value).toLowerCase()))for(b=0;b<this.options.length;b++)if(this.options[b].label.toLowerCase()===a||this.options[b].value.toLowerCase()===a)return this.setSelectedItem(this.options[b].label,this.options[b].value),this;this.setSelectedItem("","");return this};
EasySelector.prototype.openSettings=function(){var a,b=$(this.html),c=$(this.dom.settingsPanel);this.html&&!this.isOpenSettings&&(a=b.offset(),c.css({top:a.top+b.outerHeight(),left:a.left+b.outerWidth()-c.outerWidth()}).show(),this.isOpenSettings=!0,this.close());return this};
EasySelector.prototype.open=function(){var a;this.html&&!this.isOpen&&(this.closeSettings(),this.dom.list.style.width=$(this.html).width()+"px",a=$(this.html).offset(),$(this.dom.list).css({top:a.top+$(this.html).outerHeight(),left:a.left}).show(),$(this.html).addClass("expanded"),this.isOpen=!0);return this};EasySelector.prototype.closeSettings=function(){this.html&&this.isOpenSettings&&($(this.dom.settingsPanel).hide(),this.isOpenSettings=!1);return this};
EasySelector.prototype.close=function(){this.html&&this.isOpen&&($(this.html).removeClass("expanded"),$(this.dom.list).hide(),this.isOpen=!1,this.existingValue||this.processCurrentInput());return this};EasySelector.prototype.setSelectedItem=function(a,b){var c=this.value;this.label=a;this.value=b;this.html&&(this.dom.input.value=a);this.existingValue=!0;"function"===typeof this.onChange&&(b!==c&&this.htmlCreationProcessFinished)&&this.onChange.call(this,b,c);return this};
EasySelector.prototype.showSuggestions=function(a){var b,c,d=0;this.existingValue=!1;if(this.html&&"string"===typeof a){if(a){a=a.toLowerCase();c=a.length;$(this.dom.list).empty();for(b=0;b<this.options.length;b++)if(this.options[b].label.substr(0,c).toLowerCase()===a||this.options[b].value.substr(0,c).toLowerCase()===a)this.dom.list.appendChild(this.createHTMLOption(this.options[b].label,this.options[b].value)),d+=1;d||(a=document.createElement("li"),a.className="message",a.appendChild(document.createTextNode("No similar options")),
this.dom.list.appendChild(a))}else this.setOptions(this.options,!0);this.open()}return this};EasySelector.prototype.searchSuggestionsHandler=function(){var a=this;return function(b){27!==b.keyCode&&a.showSuggestions($.trim(this.value))}};
EasySelector.prototype.attachListeners=function(){var a=this;$(this.html).on("click","a",function(b){b.preventDefault();switch(this.className){case "easyselector-arrow":a.isOpen?a.close():(a.setOptions(a.options,!0),a.open());break;case "easyselector-conf":$(".easyselector-settings:visible").length?a.closeSettings():a.openSettings()}});$(this.dom.settingsPanel).on("click","a",function(b){b.preventDefault();$(a.dom.settingsPanel).find("li.selected").removeClass("selected");$(this.parentElement).addClass("selected");
"function"===typeof a.onSettingValueChange&&a.onSettingValueChange.call(a,a.getSettingValue());a.closeSettings()});$(this.dom.input).on("keyup",a.searchSuggestionsHandler()).on("keydown",function(b){27===b.keyCode?(a.setSelectedItem("",""),a.close()):13===b.keyCode&&$(this).trigger("blur")}).on("focus",function(){a.setOptions(a.options,!0);a.open()}).on("change",function(){}).on("blur",function(){a.processCurrentInput()});$(this.dom.list).on("click","a",function(b){b.preventDefault();a.setSelectedItem(this.textContent,
$(this).data("value"));a.close()});$(document).on("click focusin",function(b){!$(b.target).parents("#"+a.id).length&&(!$(b.target).parents("#"+a.id+"-list").length&&!$(b.target).parents("#"+a.id+"-settings").length)&&(a.close(),a.closeSettings())})};
EasySelector.prototype.createHTML=function(){var a,b,c,d,e,f;if(this.html)return this.html;a=document.createElement("div");a.className="easyselector";b=document.createElement("input");b.type="text";c=document.createElement("a");c.className="easyselector-arrow";c.href="#";e=document.createElement("div");e.innerHTML="&nbsp;";c.appendChild(e);d=document.createElement("a");d.className="easyselector-conf";d.href="#";e=e.cloneNode(!0);d.appendChild(e);e=document.createElement("ul");e.className="easyselector-list";
e.id=this.id+"-list";f=document.createElement("ul");f.className="easyselector-settings";f.id=this.id+"-settings";a.appendChild(b);a.appendChild(d);a.appendChild(c);document.body.appendChild(f);document.body.appendChild(e);this.dom.input=b;this.dom.arrow=c;this.dom.settings=d;this.dom.list=e;this.dom.settingsPanel=f;a.id=this.id;this.html=a;this.setSettingOptions(this.settingOptions);this.setOptions(this.options);this.setListMaxHeight(this.listMaxHeight);this.setIsConfigurable(this.configurable);this.setSettingValue(this.settingValue);
this.setSelectedItem(this.label,this.value);this.attachListeners();this.htmlCreationProcessFinished=!0;return this.html};EasySelector.prototype.getHTML=function(){this.html||this.createHTML();return this.html};EasySelector.prototype.getValue=function(){return this.value};EasySelector.prototype.getLabel=function(){return this.label};
EasySelector.prototype.setSettingValue=function(a){var b=$(this.dom.settingsPanel),c=b.find("li.selected"),b=b.find("a[data-value="+a+"]"),d,e=!1;for(d=0;d<this.settingOptions.length;d++)if(this.settingOptions[d].value===a){this.settingValue=a;e=!0;break}b.length&&e&&(b.parent().addClass("selected"),c.removeClass("selected"));return this};EasySelector.prototype.getSettingValue=function(){return $(this.dom.settingsPanel).find("li.selected a").data("value")||null};
var DecisionTable=function(a){Element.call(this,{id:a.id||jCore.Utils.generateUniqueId()});this.isDirty=this.showDirtyIndicator=this.onChange=this.onRemoveColumn=this.onAddColumn=this.width=this.rows=this.decisionRows=this.conclusions=this.conditions=this.name=this.moduleName=this.dom=this.hitType=null;this.fields=[];this.minConclusionColumnWidth=this.minConditionColumnWidth=null;DecisionTable.prototype.initObject.call(this,a||{})};DecisionTable.prototype=new Element;
DecisionTable.prototype.type="DecisionTable";
DecisionTable.prototype.initObject=function(a){var b={name:"",type:"multiple",width:"auto",rows:0,container:null,columns:{conditions:[],conclusions:[]},ruleset:[],onAddColumn:null,onRemoveColumn:null,onChange:null,fields:[],moduleName:null,showDirtyIndicator:!0,minConditionColumnWidth:"number"===typeof a.minConclusionColumnWidth?Math.floor(1.66*a.minConclusionColumnWidth):268,minConclusionColumnWidth:"number"===typeof a.minConditionColumnWidth?Math.floor(0.6*a.minConditionColumnWidth):141};$.extend(!0,
b,a);this.dom={};this.conclusions=[];this.conditions=[];this.decisionRows=0;this.onAddColumn=b.onAddColumn;this.onRemoveColumn=b.onRemoveColumn;this.onChange=b.onChange;this.rows=parseInt(b.rows,10);this.setName(b.name).setHitType(b.type).setFields(b.fields).setConditions(b.columns.conditions).setConclusions(b.columns.conclusions).setWidth(b.width).setModuleName(b.moduleName).setMinConditionColumnWidth(b.minConditionColumnWidth).setMinConclusionColumnWidth(b.minConclusionColumnWidth).setShowDirtyIndicator(b.showDirtyIndicator);
this.getHTML();b.container&&($(b.container).append(this.getHTML()),this.isDOMNodeInsertedSupported||this.updateDimensions());this.setRuleset(b.ruleset);this.conditions.length||this.addCondition();this.conclusions.length||this.addConclusion(!0);this.decisionRows||this.addDecisionRow();this.setIsDirty(!1)};DecisionTable.prototype.setShowDirtyIndicator=function(a){this.showDirtyIndicator=!!a;this.dom.dirtyIndicator&&(a?$(this.dom.dirtyIndicator).show():$(this.dom.dirtyIndicator).hide());return this};
DecisionTable.prototype.setModuleName=function(a){this.moduleName=a;return this};DecisionTable.prototype.setMinConditionColumnWidth=function(a){this.minConditionColumnWidth=a;return this};DecisionTable.prototype.setMinConclusionColumnWidth=function(a){this.minConclusionColumnWidth=a;return this};DecisionTable.prototype.setFields=function(a){var b;for(b=0;b<a.length;b+=1)this.fields.push({label:a[b].text,value:a[b].value});return this};DecisionTable.prototype.getIsDirty=function(){return this.dirty};
DecisionTable.prototype.setIsDirty=function(a){this.isDirty=a;this.html&&(this.dom.dirtyIndicator.textContent=a?"*":"");return this};DecisionTable.prototype.onChangeVariableHandler=function(){var a=this;return function(b,c){var d;d=this.getHTML();d=$(d.parentElement).find(d.tagName.toLowerCase()).index(d);d="condition"===this.mode?a.validateColumn(d,0):a.validateColumn(d,1);a.setIsDirty(!0);"function"===typeof a.onChange&&a.onChange.call(a,{object:this,newVal:b,oldVal:c},d)}};
DecisionTable.prototype.onChangeValueHandler=function(){var a=this;return function(b,c,d){var e,f,g;f=(g=b instanceof DecisionTableValueEvaluation)?b.getHTML()[0]:b.getHTML();e=f.parentElement;f=$(f.parentElement).find("td").index(f)/(g?2:1);e=$(e.parentElement).find("tr").index(e);g=a.validateColumn(f,g?0:1);g.valid&&(g=a.validateRow(e));a.setIsDirty(!0);"function"===typeof a.onChange&&a.onChange.call(a,{object:b,newVal:c,oldVal:d},g)}};
DecisionTable.prototype.removeAllConclusions=function(){for(;this.conclusions.length;)this.conclusions[0].remove();return this};DecisionTable.prototype.removeAllConditions=function(){for(;this.conditions.length;)this.conditions[0].remove();return this};DecisionTable.prototype.setConditions=function(a){var b;this.removeAllConditions();for(b=0;b<a.length;b+=1)this.addCondition(a[b]);return this};
DecisionTable.prototype.setConclusions=function(a){var b;this.removeAllConclusions();for(b=0;b<a.length;b+=1)this.addConclusion(!a[b].variable_name,a[b].variable_name,a[b].conclusion_mode);return this};
DecisionTable.prototype.setRuleset=function(a){var b,c,d={},e={},f,g;for(b=0;b<this.conditions.length;b+=1)d[this.conditions[b].select.value]?d[this.conditions[b].select.value].push(b):d[this.conditions[b].select.value]=[b];e.result=0;for(b=1;b<this.conclusions.length;b+=1)e[this.conclusions[b].select.value]=b;for(b=0;b<a.length;b+=1){g=a[b].conditions;f={};for(c=0;c<g.length;c+=1)void 0===f[g[c].variable_name]&&(f[g[c].variable_name]=-1),f[g[c].variable_name]+=1,this.conditions[d[g[c].variable_name][f[g[c].variable_name]]].addValue(g[c].value,
g[c].condition);f=a[b].conclusions;for(c=0;c<f.length;c+=1)this.conclusions[e[f[c].conclusion_value]].addValue(f[c].value);this.addDecisionRow()}this.updateDimensions();return this};DecisionTable.prototype.isDOMNodeInsertedSupported=function(){var a=this.createHTMLElement("div"),b=!1;a.addEventListener("DOMNodeInserted",function(){b=!0});a.appendChild(a.cloneNode());return b};DecisionTable.prototype.setRows=function(a){this.rows=parseInt(a,10);return this.updateDimensions()};
DecisionTable.prototype.setWidth=function(a){this.width=a;return this.updateDimensions()};
DecisionTable.prototype.updateDimensions=function(){if(!this.html)return this;var a,b,c;"auto"!==this.width?(b=$(this.dom.indexTableContainer).outerWidth()+4,a=this.width-1-b,b=Math.floor(0.7*a)-1,c=a-b-1):($(this.dom.conditionsHeader.parentElement).css("width","").find("th").css("width",""),$(this.dom.conclusionsTable).css("width",""),$(this.dom.conclusionsHeader.parentElement).css("width","").find("th").css("width",""));this.dom.conditionsTableContainer.style.width=this.dom.conditionsHeaderContainer.style.width=
"auto"!==this.width?b+"px":"auto";this.dom.conclusionsTableContainer.style.width=this.dom.conclusionsHeaderContainer.style.width="auto"!==this.width?c+"px":"auto";this.decisionRows&&this.rows?(a=$(this.dom.conditionsTable).find("tr").outerHeight(),this.dom.indexTableContainer.style.height=this.dom.conditionsTableContainer.style.height=this.dom.conclusionsTableContainer.style.height=a*this.rows+10+this.rows+"px"):this.dom.indexTableContainer.style.height=this.dom.conditionsTableContainer.style.height=
this.dom.conclusionsTableContainer.style.height="auto";a=$(this.dom.conditionsTableContainer).width();this.minConditionColumnWidth*this.conditions.length+2*this.conditions.length<=a&&"auto"!==this.width?(this.dom.conditionsTable.style.width="100%",a=Math.ceil($(this.dom.conditionsTable).innerWidth()/this.conditions.length)):a=this.minConditionColumnWidth;b=Math.round(0.4*a);$(this.dom.conditionsTable).css("width",a*this.conditions.length+2*this.conditions.length+"px").find("td").css("width","").end().find("tr").eq(0).find("td.decision-table-operator").css("width",
b+"px").end().find("td").not(".decision-table-operator").css("width",a-b+"px");a=$(this.dom.conditionsTable).width();$(this.dom.conditionsHeader.parentElement).css("width",a+"px");a=Math.ceil(a/this.conditions.length);$(this.dom.conditionsHeader).find("th").css("width",a+"px");c=this.minConclusionColumnWidth*this.conclusions.length+this.conclusions.length;a=$(this.dom.conclusionsTableContainer).width();c<=a&&"auto"!==this.width?(c="100%",a=Math.ceil($(this.dom.conclusionsTable).innerWidth()/this.conclusions.length)):
(a=this.minConclusionColumnWidth,c+="px");$(this.dom.conclusionsTable).css("width",c).find("td").css("width","").end().find("tr").eq(0).find("td").css("width",a+"px");$(this.dom.conclusionsHeader.parentElement).css("width",c);$(this.dom.conclusionsHeader).find("th").css("width",a+"px");return this};
DecisionTable.prototype.createRemoveButton=function(){var a=this.createHTMLElement("span");a.tabIndex=0;a.className="decision-table-remove";$(a).attr("title","Remove row").append(document.createTextNode("-"));return a};
DecisionTable.prototype.addDecisionRow=function(){var a=this.createHTMLElement("tr"),b,c;if(!this.conditions.length||!this.conclusions.length)return this;for(b=0;b<this.conditions.length;b+=1)this.conditions[b].values[this.decisionRows]||this.conditions[b].addValue(),c=this.conditions[b].getValueHTML(this.conditions[b].values.length-1),a.appendChild(c[0]),a.appendChild(c[1]);this.dom.conditionsTable.appendChild(a);a=a.cloneNode(!1);for(b=0;b<this.conclusions.length;b+=1)this.conclusions[b].values[this.decisionRows]||
this.conclusions[b].addValue(),a.appendChild(this.conclusions[b].getValueHTML(this.conclusions[b].values.length-1));this.dom.conclusionsTable.appendChild(a);a=a.cloneNode(!1);c=this.createRemoveButton();this.decisionRows+=1;b=this.createHTMLElement("td");b.appendChild(c);a.appendChild(b);this.dom.indexTable.appendChild(a);1===this.decisionRows&&this.updateDimensions();return this};
DecisionTable.prototype.removeDecisionRow=function(a){var b,c=!1,d=!1;for(b=0;b<this.conditions.length;b+=1)if(this.conditions[b].values[a].filledValue()){d=!confirm("Do you really want to delete this rule set?");c=!0;break}if(d)return this;if(!c)for(b=0;b<this.conclusions.length;b+=1)if(this.conclusions[b].values[a].filledValue()){if(!confirm("Do you really want to delete this rule set?"))return this;break}for(b=0;b<this.conclusions.length;b+=1)this.conclusions[b].removeValue(a);for(b=0;b<this.conditions.length;b+=
1)this.conditions[b].removeValue(a);$(this.dom.indexTable).find("tr:eq("+a+")").remove();$(this.dom.conditionsTable).find("tr:eq("+a+")").remove();$(this.dom.conclusionsTable).find("tr:eq("+a+")").remove();this.decisionRows--;this.setIsDirty(!0);a=this.validateColumn();"function"===typeof this.onChange&&this.onChange.call(this,{},a);return this};DecisionTable.prototype.getFields=function(){return this.fields};DecisionTable.prototype.setName=function(a){this.name=a;return this};
DecisionTable.prototype.setProxy=function(a,b){this.proxy=a;b&&b instanceof RestClient&&(this.proxy.restClient=b);return this};DecisionTable.prototype.setHitType=function(a){this.hitType=a;return this};
DecisionTable.prototype.onRemoveVariableHandler=function(a){var b=this,c;return function(){var d,e;for(e=0;e<a.length;e+=1)a[e]===this&&(d=a[e],a.splice(e,1));b.updateDimensions();c=b.validateRow();"function"===typeof b.onRemoveColumn&&b.onRemoveColumn.call(this,d);b.setIsDirty(!0);"function"===typeof b.onChange&&b.onChange.call(b,{},c)}};
DecisionTable.prototype.addCondition=function(a){a=new DecisionTableVariable({parent:this,value:a||null,fields:this.getFields()});var b,c;a.onRemove=this.onRemoveVariableHandler(this.conditions);a.onChangeValue=this.onChangeValueHandler();a.onChange=this.onChangeVariableHandler();this.conditions.push(a);this.html&&this.dom.conditionsHeader.appendChild(a.getHTML());for(b=0;b<this.decisionRows;b+=1)a.addValue(),c=a.getValueHTML(b),$(this.dom.conditionsTable).find("tr:eq("+b+")").append(c[0]).append(c[1]);
this.updateDimensions();this.setIsDirty(!0);"function"===typeof this.onAddColumn&&this.onAddColumn.call(this,a);return this};
DecisionTable.prototype.addConclusion=function(a,b,c){a=new DecisionTableVariable({returnType:a,mode:"conclusion",fields:this.getFields(),value:b,parent:this,behavior:c||"set"});a.onRemove=this.onRemoveVariableHandler(this.conclusions);a.onChangeValue=this.onChangeValueHandler();a.onChange=this.onChangeVariableHandler();this.conclusions.push(a);this.html&&this.dom.conclusionsHeader.appendChild(a.getHTML());for(b=0;b<this.decisionRows;b+=1)a.addValue(),this.dom.conclusionsTable.childNodes[b].appendChild(a.getValueHTML(b));
this.updateDimensions();this.setIsDirty(!0);"function"===typeof this.onAddColumn&&this.onAddColumn.call(this,a);return this};
DecisionTable.prototype.createHTML=function(){if(this.html)return this.html;var a,b,c,d,e,f;c=this.createHTMLElement("thead");a=this.createHTMLElement("tr");b=this.createHTMLElement("th");b.className="decision-table-title";b.colSpan=3;e=this.createHTMLElement("div");d=this.createHTMLElement("span");d.appendChild(document.createTextNode("single"===this.hitType?"[Single Hit]":"[Multiple Hit]"));d.className="decision-table-type";d.tabIndex=0;this.dom.hitTypeLabel=d;e.appendChild(d);d=d.cloneNode(!1);
d.appendChild(document.createTextNode(this.name));d.className="decision-table-name";this.dom.nameLabel=d;e.appendChild(d);d=d.cloneNode(!1);$(d).removeAttr("tabIndex");d.textContent=this.isDirty?"*":"";e.appendChild(d);this.dom.dirtyIndicator=d;d=d.cloneNode(!1);d.className="decision-table-module";d.appendChild(document.createTextNode(this.moduleName));e.appendChild(d);b.appendChild(e);a.appendChild(b);c.appendChild(a);this.dom.title=b;a=this.createHTMLElement("tr");b=this.createHTMLElement("th");
a.appendChild(b);b=this.createHTMLElement("th");d=this.createHTMLElement("button");d.appendChild(document.createTextNode("+"));d.className="decision-table-add-button";this.dom.addConditionButton=d;e=this.createHTMLElement("span");e.appendChild(document.createTextNode("Conditions"));e.appendChild(d);b.appendChild(e);b.className="decision-table-separator-border";a.appendChild(b);b=b.cloneNode(!1);d=d.cloneNode(!0);this.dom.addConclusionButton=d;e=e.cloneNode(!1);e.appendChild(document.createTextNode("Conclusions"));
e.appendChild(d);b.appendChild(e);a.appendChild(b);c.appendChild(a);a=this.createHTMLElement("tr");b=this.createHTMLElement("th");e=this.createHTMLElement("button");e.appendChild(document.createTextNode("+"));e.title="Add row";e.className="decision-table-add-row";b.appendChild(e);a.appendChild(b);b=this.createHTMLElement("th");e=this.createHTMLElement("div");e.className="decision-table-conditions-header";this.dom.conditionsHeaderContainer=e;f=this.createHTMLElement("table");f.appendChild(a.cloneNode(!1));
e.appendChild(f);this.dom.conditionsHeader=f.childNodes[0];b.className="decision-table-separator-border";b.appendChild(e);a.appendChild(b);b=b.cloneNode(!0);this.dom.conclusionsHeaderContainer=b.childNodes[0];this.dom.conclusionsHeaderContainer.className="decision-table-conclusions-header decision-table-scroll-y";this.dom.conclusionsHeader=this.dom.conclusionsHeaderContainer.childNodes[0].childNodes[0];a.appendChild(b);d=this.createHTMLElement("tbody");d.appendChild(a);a=this.createHTMLElement("tr");
b=this.createHTMLElement("td");e=e.cloneNode(!1);e.className="decision-table-container";this.dom.indexTableContainer=e;f=f.cloneNode(!1);f.className="decision-table-index";this.dom.indexTable=f;e.appendChild(f);b.appendChild(e);a.appendChild(b);b=b.cloneNode(!0);this.dom.conditionsTable=(this.dom.conditionsTableContainer=b.childNodes[0]).childNodes[0];this.dom.conditionsTable.className="decision-table-conditions";b.className="decision-table-separator-border";a.appendChild(b);b=b.cloneNode(!0);b.className=
"";this.dom.conclusionsTable=(this.dom.conclusionsTableContainer=b.childNodes[0]).childNodes[0];$(this.dom.conclusionsTableContainer).addClass("decision-table-scroll-y");this.dom.conclusionsTable.className="decision-table-conclusions";a.appendChild(b);d.appendChild(a);a=this.createHTMLElement("table");a.className="decision-table";a.appendChild(c);a.appendChild(d);this.html=a;for(c=0;c<this.conditions.length;c+=1)this.dom.conditionsHeader.appendChild(this.conditions[c].getHTML());for(c=0;c<this.conclusions.length;c+=
1)this.dom.conclusionsHeader.appendChild(this.conclusions[c].getHTML());this.setShowDirtyIndicator(this.showDirtyIndicator);this.attachListeners();return this.html};
DecisionTable.prototype.attachListeners=function(){var a=this;$(this.dom.conditionsTableContainer).on("scroll",function(){a.dom.conditionsHeaderContainer.scrollLeft=this.scrollLeft;a.dom.conclusionsTableContainer.scrollTop=this.scrollTop});$(this.dom.conditionsHeaderContainer).on("scroll",function(){a.dom.conditionsTableContainer.scrollLeft=this.scrollLeft});$(this.dom.conclusionsTableContainer).add(this.dom.conclusionsHeaderContainer).on("scroll",function(){a.dom.conclusionsHeaderContainer.scrollLeft=
a.dom.conclusionsTableContainer.scrollLeft=this.scrollLeft;a.dom.indexTableContainer.scrollTop=a.dom.conditionsTableContainer.scrollTop=this.scrollTop});$(this.dom.indexTableContainer).on("scroll",function(){a.dom.conditionsTableContainer.scrollTop=a.dom.conclusionsTableContainer.scrollTop=this.scrollTop});$(this.dom.addConclusionButton).on("click",function(){a.addConclusion()});$(this.dom.addConditionButton).on("click",function(){a.addCondition()});$(this.dom.indexTable).on("click","span",function(){a.removeDecisionRow($(a.dom.indexTable).find("span").index(this))});
$(this.dom.conditionsTable).on("keydown","td",function(b){var c,d=this.parentElement;9===b.keyCode&&(c=$(d.parentElement).find("tr").index(d),$(d).find("td:last").get(0)===this&&!b.shiftKey?(b.preventDefault(),$(a.conclusions[0].getValueHTML(c)).find("span").focus()):$(d).find("td:first").get(0)===this&&b.shiftKey&&(b.preventDefault(),$(a.dom.indexTable).find("span").eq(c).focus()))});$(this.dom.indexTable).on("keydown","td",function(b){var c;c=this.parentElement;9===b.keyCode&&(c=$(c.parentElement).find("tr").index(c),
b.shiftKey?0<c&&(b.preventDefault(),$(a.conclusions[a.conclusions.length-1].getValueHTML(c-1)).find("span").focus()):(b.preventDefault(),$(a.conditions[0].getValueHTML(c)[0]).find("span").focus()))});$(this.dom.conclusionsTable).on("keydown","td",function(b){var c,d=this.parentElement;9===b.keyCode&&(c=$(d.parentElement).find("tr").index(d),$(d).find("td:last").get(0)===this&&!b.shiftKey&&c<a.decisionRows-1?(b.preventDefault(),$(a.dom.indexTable).find("span").eq(c+1).focus()):$(d).find("td:first").get(0)===
this&&b.shiftKey&&(b.preventDefault(),$(a.conditions[a.conditions.length-1].getValueHTML(c)[1]).find("span").focus()))});$(this.dom.conditionsTable).on("keydown","td",function(b){var c,d=this.parentElement;9===b.keyCode&&(c=$(d.parentElement).find("tr").index(d),$(d).find("td:last").get(0)===this&&!b.shiftKey?(b.preventDefault(),$(a.conclusions[0].getValueHTML(c)).find("span").focus()):$(d).find("td:first").get(0)===this&&b.shiftKey&&(b.preventDefault(),$(a.dom.indexTable).find("button").eq(c).focus()))});
$(this.dom.indexTable).on("keydown","td",function(b){var c,d=this.parentElement;9===b.keyCode&&(c=$(d.parentElement).find("tr").index(d),$(d).find("td:last").get(0)===this&&!b.shiftKey?(b.preventDefault(),$(a.conditions[0].getValueHTML(c)[0]).find("span").focus()):$(d).find("td:first").get(0)===this&&(b.shiftKey&&0<c)&&(b.preventDefault(),$(a.conclusions[a.conclusions.length-1].getValueHTML(c-1)).find("span").focus()))});$(this.dom.conclusionsTable).on("keydown","td",function(b){var c,d=this.parentElement;
9===b.keyCode&&(c=$(d.parentElement).find("tr").index(d),$(d).find("td:last").get(0)===this&&!b.shiftKey&&c<a.decisionRows-1?(b.preventDefault(),$(a.dom.indexTable).find("button").eq(c+1).focus()):$(d).find("td:first").get(0)===this&&b.shiftKey&&(b.preventDefault(),$(a.conditions[a.conditions.length-1].getValueHTML(c)[1]).find("span").focus()))});$(this.html).find(".decision-table-add-row").on("click",function(){a.addDecisionRow()});$(this.dom.nameLabel).on("focus",function(){var b=a.createHTMLElement("input");
b.type="text";b.value=a.name;$(this).empty().append(b);$(b).select().focus()}).on("blur","input",function(){this.value&&(a.name=$.trim(this.value));$(this.parentElement).text(a.name)});$(this.dom.hitTypeLabel).on("focus",function(){var b=a.createHTMLElement("select"),c=a.createHTMLElement("option");c.label="Multiple Hit";c.value="multiple";c.appendChild(document.createTextNode(c.label));c.selected="single"!==a.hitType;b.appendChild(c);c=c.cloneNode(!1);c.label="Single Hit";c.value="single";c.appendChild(document.createTextNode(c.label));
c.selected="single"===a.hitType;b.appendChild(c);$(this).empty().append(b);$(b).focus()}).on("blur","select",function(){a.hitType=this.value;$(this.parentElement).text("single"===a.hitType?"[Single Hit]":"[Multiple Hit]")});$(this.dom.conditionsTable).add(this.dom.conclusionsTable).add(this.dom.indexTable).on("focus","td",function(){var b=this.parentElement;$(a.html).find("tr.cell-edit").removeClass("cell-edit");b=$(b.parentElement).find("tr").index(b);$(a.dom.indexTable.childNodes[b]).add(a.dom.conditionsTable.childNodes[b]).add(a.dom.conclusionsTable.childNodes[b]).addClass("cell-edit")});
$(document).bind("DOMNodeInserted",function(b){b.target===a.html&&a.updateDimensions()});return this};
DecisionTable.prototype.validateConclusions=function(){var a,b={};for(a=0;a<this.conclusions.length;a+=1){if(!this.conclusions[a].returnType&&this.conclusions[a].select.value&&this.conclusions[a].getFilledValuesNum()){if(b[this.conclusions[a].select.value])return $(this.conclusions[a].getHTML()).addClass("error"),{valid:!1,location:"Conclusion # "+(a+1),message:"conclusion variable is duplicated"};b[this.conclusions[a].select.value]=!0}$(this.conclusions[a].getHTML()).removeClass("error")}return{valid:!0}};
DecisionTable.prototype.validateRow=function(a){var b=0,c=this.decisionRows,d=0,e,f;"number"===typeof a&&(b=a,c=a+1);for(e=b;e<c;e+=1){a=b=!1;for(f=0;f<this.conditions.length;f+=1)if(this.conditions[f].values[e].filledValue()){b=!0;break}if(b)if(this.conclusions[0].values[e].filledValue())a=!0;else return $(this.conclusions[0].values[e].getHTML()).addClass("error"),{valid:!1,message:'The "Return" conclusion is empty',location:"row # "+(e+1)};$(this.conclusions[0].values[e].getHTML()).removeClass("error");
if(!a)for(f=0;f<this.conclusions.length;f+=1)if(this.conclusions[f].values[e].filledValue()){a=!0;break}if(a&&!b&&(d+=1,1<d))return $(this.dom.conditionsTable).find("tr").eq(e).addClass("error"),{valid:!1,message:"No conditions were specified in row with conclusions, It's allowed only one row with no conditions (default ruleset)",location:"row # "+(e+1)};$(this.dom.conditionsTable).find("tr").eq(e).removeClass("error")}return{valid:!0}};
DecisionTable.prototype.validateColumn=function(a,b){var c,d,e,f=[{type:"condition",collection:this.conditions},{type:"conclusion",collection:this.conclusions}];$(this.dom.conditionsTable).find("tr").removeClass("error");if("number"===typeof a&&"number"===typeof b){if(c=f[b].collection[a].isValid(),!c.valid)return{valid:!1,message:c.message,location:f[b].type+" # "+(a+1)+(!isNaN(c.index)?" - row "+(c.index+1):"")}}else for(e=0;e<f.length;e+=1)for(d=0;d<f[e].collection.length;d+=1)if(c=f[e].collection[d].isValid(),
!c.valid)return{valid:!1,message:c.message,location:f[e].type+" # "+(d+1)+(!isNaN(c.index)?" - row "+(c.index+1):"")};return{valid:!0}};DecisionTable.prototype.isValid=function(){var a=this.validateColumn();if(!a.valid)return a;a=this.validateRow();return!a.valid?a:this.validateConclusions()};
DecisionTable.prototype.getJSON=function(){var a={moduleName:this.moduleName,type:this.hitType,name:this.name,columns:{conditions:[],conclusions:[]},ruleset:[]},b,c,d,e,f,g,h=0;if(!this.isValid().valid)return null;g={};for(f=0;f<this.decisionRows;f+=1){for(e=0;e<this.conditions.length;e+=1)this.conditions[e].select.value&&this.conditions[e].values[f].getValue().length&&(g[this.conditions[e].select.value]||(g[this.conditions[e].select.value]={max:0,current:0}),g[this.conditions[e].select.value].current+=
1,g[this.conditions[e].select.value].current>g[this.conditions[e].select.value].max&&(g[this.conditions[e].select.value].max=g[this.conditions[e].select.value].current));for(e in g)g[e].current=0}for(e=0;e<this.conditions.length;e+=1)if(g[this.conditions[e].select.value]){for(f=0;f<g[this.conditions[e].select.value].max;f+=1)a.columns.conditions.push(this.conditions[e].select.value);delete g[this.conditions[e].select.value]}for(e=0;e<this.conclusions.length;e+=1)if(this.conclusions[e].returnType||
this.conclusions[e].select.value&&this.conclusions[e].getFilledValuesNum())a.columns.conclusions.push({variable_name:this.conclusions[e].select?this.conclusions[e].select.value:"",conclusion_mode:this.conclusions[e].select?this.conclusions[e].behavior:""});for(e=0;e<this.decisionRows;e+=1){b={id:e+1};c=[];d=[];for(f=0;f<this.conditions.length;f+=1)(g=this.conditions[f].getJSON(e))&&c.push(g);for(f=0;f<this.conclusions.length;f+=1)g=this.conclusions[f].getJSON(e),g.value.length&&d.push(g);b.conditions=
c;b.conclusions=d;c.length||(h+=1);(c.length||1>=h)&&a.ruleset.push(b)}return a};var MultipleItemField=function(a,b){this.items=[];Field.call(this,a,b);this.itemsContainer=this.fieldHeight=this.panel=this.controlObject=null;MultipleItemField.prototype.initObject.call(this,a)};MultipleItemField.prototype=new Field;MultipleItemField.prototype.initObject=function(a){var b={items:[],fieldWidth:280,fieldHeight:120,panel:null};$.extend(!0,b,a);this.setPanel(b.panel||new MultipleItemPanel).setItems(b.items).setFieldWidth(b.fieldWidth).setFieldHeight(b.fieldHeight)};
MultipleItemField.prototype.setPanel=function(a){a instanceof MultipleItemPanel&&(this.panel&&$(this.panel.getHTML()).remove(),this.panel=a);return this};MultipleItemField.prototype.setValue=function(a){a&&(a=JSON.parse(a),this.setItems(a));return this};MultipleItemField.prototype.setFieldWidth=function(a){isNaN(a)||(this.fieldWidth=a);return this};MultipleItemField.prototype.setFieldHeight=function(a){isNaN(a)||(this.fieldHeight=a);return this};
MultipleItemField.prototype.addItem=function(a){var b=this;if(!(a instanceof SingleItem))if("object"===typeof a)a=new SingleItem({label:a.label||"",value:a.value||null});else return this;this.items.push(a);$(this.controlObject).before(a.getHTML());a.onRemove=function(){b.removeItem(this)};this.hidePanel();this.onChange();return this};
MultipleItemField.prototype.removeItem=function(a){a=a.id;var b=null,c;for(c=0;c<this.items.length;c+=1)if(this.items[c].id===a){b=c;break}null!==b&&this.items.splice(b,1);this.hidePanel();$(this.controlObject).focus();this.onChange();return this};MultipleItemField.prototype.clear=function(){$(this.itemsContainer).find("> li").remove();this.items=[]};MultipleItemField.prototype.setItems=function(a){var b;for(b=0;b<a.length;b+=1)this.addItem(a[b]);return this};
MultipleItemField.prototype.hidePanel=function(){var a;$(this.itemsContainer).removeClass("expanded");for(a=0;a<this.items.length;a++)$(this.items[a].html).removeClass("focused");this.panel.close();return this};MultipleItemField.prototype.scrollTo=function(){var a=this.html.parentNode;if(a.scrollTop+$(a).outerHeight()<getRelativePosition(this.itemsContainer,a).top+$(this.itemsContainer).outerHeight()+a.scrollTop)this.html.parentNode.scrollTop=$(this.itemsContainer).position().top;else return this};
MultipleItemField.prototype.showPanel=function(){$(this.itemsContainer).addClass("focused");$(this.panel.html).addClass("focused");this.panel.open();$(this.itemsContainer).addClass("expanded");return this};MultipleItemField.prototype.createControlObject=function(){var a=document.createElement("input");a.className="multiple-item-input";return a};
MultipleItemField.prototype.attachListeners=function(){var a,b,c=this;a=this.controlObject;b=this.itemsContainer;$(this.itemsContainer).on("click",function(b){b.stopPropagation();$(a).focus().select()});$(a).focus(function(a){c.scrollTo();$(b).addClass("focused");$(c.panel.html).addClass("focused")}).blur(function(){c.hidePanel();$(b).removeClass("focused");$(c.panel.html).removeClass("focused")}).on("keyup",function(a){27===a.keyCode&&c.hidePanel()}).on("keydown",function(a){a.stopPropagation()});
return this};
MultipleItemField.prototype.createHTML=function(){var a,b="",c=this;Field.prototype.createHTML.call(this);this.required&&(b="<i>*</i> ");a=this.createHTMLElement("span");a.className="adam-form-label";a.innerHTML=b+this.label+":";a.style.width=this.parent.labelWidth;a.style.verticalAlign="top";this.html.appendChild(a);a=this.createHTMLElement("ul");a.className="multiple-item-container";a.id=this.name;this.fieldWidth&&this.fieldHeight&&(b=document.createAttribute("style"),this.fieldWidth&&(b.value+=
"width: "+this.fieldWidth+"px; "),this.fieldHeight&&(b.value+="height: "+this.fieldHeight+"px; "),a.setAttributeNode(b));for(b=0;b<this.items.length;b+=1)a.appendChild(this.items[b].getHTML());b=this.createControlObject();a.appendChild(b);this.html.appendChild(a);this.errorTooltip&&this.html.appendChild(this.errorTooltip.getHTML());this.helpTooltip&&this.html.appendChild(this.helpTooltip.getHTML());this.itemsContainer=a;this.controlObject=b;$(this.parent.body).on("scroll",function(){c.hidePanel()});
this.panel.belongsTo=this.itemsContainer;this.parent.parent.html.appendChild(this.panel.getHTML());return this.html};MultipleItemField.prototype.evalRequired=function(){var a=!0;this.required&&((a=0<this.items.length)?$(this.itemsContainer).removeClass("required"):$(this.itemsContainer).addClass("required"));return a};MultipleItemField.prototype.getObject=function(){var a,b=[];for(a=0;a<this.items.length;a++)b.push(this.items[a].getObject());return b};
MultipleItemField.prototype.getObjectValue=function(){this.value=JSON.stringify(this.getObject());return Field.prototype.getObjectValue.call(this)};var MultipleItemPanel=function(a){Element.call(this,{style:{cssProperties:{display:"none"},cssClasses:["multiple-item-panel"]}});this.matchParentWidth=this.subpanels=this.buttons=this.isOpen=this.belongsTo=null;MultipleItemPanel.prototype.initObject.call(this,a)};MultipleItemPanel.prototype=new Element;MultipleItemPanel.prototype.type="MultipleItemPanel";
MultipleItemPanel.prototype.initObject=function(a){var b={belongsTo:null,buttons:[],matchParentWidth:!0,width:200};$.extend(!0,b,a);this.belongsTo=b.belongsTo;this.buttons=[];this.subpanels=[];this.isOpen=!1;this.width=b.width;this.matchParentWidth=b.matchParentWidth;this.setButtons(b.buttons)};
MultipleItemPanel.prototype.refreshPosition=function(){var a,b=0,c=0;this.html&&(a=getRelativePosition(this.belongsTo,this.html.parentElement),"absolute"!==this.html.parentElement.style.position&&(b=parseInt($(this.html.parentElement).css("margin-top"),10),c=parseInt($(this.html.parentElement).css("margin-left"),10)),this.matchParentWidth&&this.setWidth($(this.belongsTo).outerWidth()-2),this.setY(a.top+b-1+$(this.belongsTo).outerHeight()),this.setX(a.left+c),this.style.addProperties({display:"none",
zIndex:999}));return this};MultipleItemPanel.prototype.setBelongsTo=function(a){this.belongsTo=a;this.refreshPosition();return this};MultipleItemPanel.prototype.createSubpanel=function(a,b){var c;switch(b){case "list":c=new MultipleItemListSubpanel(a)}return c};MultipleItemPanel.prototype.createButtonPanel=function(a){return new MultipleItemButtonPanel(a)};MultipleItemPanel.prototype.showSubPanel=function(a){this.html&&this.html.appendChild(a.getHTML())};
MultipleItemPanel.prototype.addSubpanel=function(a,b){var c;c=a instanceof MultipleItemSubpanel?a:this.createSubpanel(a,b);this.subpanels.push(c);this.html&&this.html.appendChild(c.getHTML());return this};
MultipleItemPanel.prototype.addButton=function(a){var b,c;if("string"===typeof a.caption){b=new Element({style:{cssClasses:["multiple-item-panel-button"],cssProperties:{position:"relative",width:"auto",height:"auto"}}});if("function"===typeof a.onClick)$(b.getHTML()).on("mousedown",function(c){c.stopPropagation();0!==c.button&&void 0!==c.button||a.onClick.call(b,c)});else $(b).on("mousedown",function(a){a.stopPropagation()});b.getHTML().style.position="relative";b.getHTML().style.width="auto";b.getHTML().style.height=
"auto";c=b.createHTMLElement("span");c.innerHTML=a.caption;b.getHTML().appendChild(c);b.data=a.data;b.name=a.caption;this.buttons.push(b);this.html&&this.html.appendChild(b.getHTML())}return this};MultipleItemPanel.prototype.setButtons=function(a){var b;for(b=0;b<a.length;b++)this.addButton(a[b]);return this};MultipleItemPanel.prototype.clear=function(){this.buttons=[];this.subpanels=[];$(this.html).empty();return this};
MultipleItemPanel.prototype.createHTML=function(){var a=Element.prototype.createHTML.call(this),b;a.style.height="auto";for(b=0;b<this.subpanels.length;b++)this.html.appendChild(this.subpanels[b].getHTML());$(this.html).on("mousedown",function(a){a.stopPropagation()}).on("click",function(a){a.stopPropagation()}).on("mouseup",function(a){a.stopPropagation()});this.matchParentWidth||(a.style.width=this.width+"em");return a};
MultipleItemPanel.prototype.open=function(){var a;if(this.isOpen||!this.belongsTo)return this;this.html||this.getHTML();this.refreshPosition();for(a=0;a<this.buttons.length;a++)this.html.appendChild(this.buttons[a].getHTML());this.isOpen=!0;$(this.html).slideDown();return this};MultipleItemPanel.prototype.close=function(){this.isOpen=!1;$(this.html).hide();return this};
MultipleItemPanel.prototype.remove=function(){$(this.html).remove();delete this.subpanels;delete this.belongsTo;delete this.isOpen;delete this.buttons;delete this.matchParentWidth};var MultipleItemSubpanel=function(a){Element.call(this);this.onClose=this.onOpen=this.showContentOnStart=this.visibleHeader=this.collapsable=this.content=this.title=this.header=null;MultipleItemSubpanel.prototype.initObject.call(this,a)};MultipleItemSubpanel.prototype=new Element;MultipleItemSubpanel.prototype.type="mutlipleItemSubPanel";
MultipleItemSubpanel.prototype.initObject=function(a){var b={title:"",collapsable:!1,showContentOnStart:!1,visibleHeader:!0,onOpen:null,onClose:null};$.extend(!0,b,a);this.showContentOnStart=b.showContentOnStart;this.onOpen=b.onOpen;this.onClose=b.onClose;this.setTitle(b.title).setIsCollapsable(b.collapsable).isVisibleHeader(b.visibleHeader)};MultipleItemSubpanel.prototype.isVisibleHeader=function(a){this.visibleHeader=a;this.header&&(this.header.style.display=a?"block":"none");return this};
MultipleItemSubpanel.prototype.setTitle=function(a){this.title=a;this.header&&$(this.header).find(".header-text").text(this.title);return this};MultipleItemSubpanel.prototype.setIsCollapsable=function(a){"boolean"===typeof a&&(this.collapsable=a);return this};MultipleItemSubpanel.prototype.reset=function(){};
MultipleItemSubpanel.prototype.close=function(){var a=this;this.isOpen=!1;$(this.html).removeClass("opened").find(".header .bullet").removeClass("adam-menu-icon-arrow-down");$(this.content).slideUp(function(){a.reset()});"function"===typeof this.onClose&&this.onClose.call(this);return this};
MultipleItemSubpanel.prototype.open=function(){document.createElement("div");var a=$(this.content);this.isOpen=!0;if("none"!==a.css("display"))return this;$(this.html).addClass("opened").find(".header .bullet").addClass("adam-menu-icon-arrow-down");this.displayFormOnStart?$(this.content).css("display","block"):$(this.content).slideDown();"function"===typeof this.onOpen&&this.onOpen.call(this);return this};
MultipleItemSubpanel.prototype.attachListeners=function(){var a=this;$(this.header).on("mousedown",function(b){b.stopPropagation();b.preventDefault();0!==b.button&&void 0!==b.button||(a.isOpen?a.close():a.open())});return this};MultipleItemSubpanel.prototype.hideLoader=function(){this.content&&$(this.content).find(".loader").remove();return this};
MultipleItemSubpanel.prototype.showLoader=function(){var a;if(this.content){if($(this.content).find(".loader").get(0))return this;a=document.createElement("div");a.className="loader";a.appendChild(document.createTextNode("loading..."));$(this.content).prepend(a)}return this};
MultipleItemSubpanel.prototype.createHTML=function(){var a,b,c;this.html||(Element.prototype.createHTML.call(this),this.html.style.height="auto",this.html.style.width="auto",this.html.style.position="relative",this.html.className="multiple-item-subpanel",a=this.createHTMLElement("div"),a.className="header",c=this.createHTMLElement("div"),c.className="content",this.visibleHeader||(a.style.display="none"),this.collapsable&&(b=this.createHTMLElement("span"),b.className="adam-menu-icon-arrow-right bullet",
c.style.display="none",a.appendChild(b)),b=this.createHTMLElement("span"),b.className="header-text",b.appendChild(document.createTextNode(this.title)),a.appendChild(b),this.header=a,this.content=c,this.html.appendChild(a),this.html.appendChild(c),this.attachListeners(),this.showContentOnStart&&$(a).trigger("mousedown"));return this.html};
var MultipleItemListSubpanel=function(a){MultipleItemSubpanel.call(this,a);this.onItemSelect=this.listMaxHeight=this.items=null;MultipleItemListSubpanel.prototype.initObject.call(this,a)};MultipleItemListSubpanel.prototype=new MultipleItemSubpanel;MultipleItemListSubpanel.prototype.initObject=function(a){var b={items:[],listMaxHeight:null,onItemSelect:null};this.items=[];this.listMaxHeight=b.listMaxHeight;this.onItemSelect=a.onItemSelect;$.extend(!0,b,a);this.setItems(b.items)};
MultipleItemListSubpanel.prototype.selectItem=function(a){this.html&&$(this.html).find("li:eq("+a+")").trigger("mousedown");return this};MultipleItemListSubpanel.prototype.setItems=function(a){var b;if(a.push)for(b=0;b<a.length;b++)this.addItem(a[b]);return this};
MultipleItemListSubpanel.prototype.displayItem=function(a){var b,c,d=this,e,f=a.label||a.text;if(this.html){e={label:f};b=$(this.html).find("ul");c=$(document.createElement("li"));c.html(f||"untitled");c.data("value",a.value||null);c.data("label",f);c.data("data",$.extend(!0,e,a.data));if("function"===typeof this.onItemSelect)c.on("mousedown",function(a){a.stopPropagation();0!==a.button&&void 0!==a.button||d.onItemSelect.call(d,$(this).data("value"),$(this).data("data"))});b.append(c)}return this};
MultipleItemListSubpanel.prototype.clear=function(){this.items=[];$(this.content).find("ul").empty();return this};MultipleItemListSubpanel.prototype.addItem=function(a){this.items.push(a);this.displayItem(a);return this};
MultipleItemListSubpanel.prototype.createHTML=function(){var a;MultipleItemSubpanel.prototype.createHTML.call(this);a=this.createHTMLElement("ul");a.className="multiple-item-list";a.style.height="auto";a.style.overflow="auto";this.listMaxHeight&&$(a).css("max-height",this.listMaxHeight);this.content.appendChild(a);for(a=0;a<this.items.length;a++)this.displayItem(this.items[a]);return this.html};
var MultipleItemButtonPanel=function(a){Element.call(this,{style:{cssClasses:["multiple-item-button-panel"]}});this.fallbackOnClickHandler=this.label=this.buttonsContainer=this.buttons=null;MultipleItemButtonPanel.prototype.initObject.call(this,a)};MultipleItemButtonPanel.prototype=new Element;
MultipleItemButtonPanel.prototype.initObject=function(a){var b={buttons:[],label:"[Button Panel]",fallbackOnClickHandler:null};$.extend(!0,b,a);this.buttons=[];this.fallbackOnClickHandler=b.fallbackOnClickHandler;this.setButtons(b.buttons).setLabel(b.label)};MultipleItemButtonPanel.prototype.setLabel=function(a){this.label=a;this.html&&$(this.html).find(".label").text(a);return this};
MultipleItemButtonPanel.prototype.getButtonHTML=function(a){var b;if(a.html)return a.html;b=this.createHTMLElement("button");b.value=a.value;b.appendChild(document.createTextNode(a.caption));if("function"===typeof a.onClick)$(b).on("mousedown",function(b){b.stopPropagation();0!==b.button&&void 0!==b.button||a.onClick.call(a)});a.html=b;return a.html};
MultipleItemButtonPanel.prototype.addButton=function(a){"object"===typeof a&&(a.onClick||(a.onClick=this.fallbackOnClickHandler),this.buttons.push(a),this.buttonsContainer&&this.buttonsContainer.appendChild(this.getButtonHTML(a)));return this};MultipleItemButtonPanel.prototype.setButtons=function(a){var b;this.buttons=[];this.buttonsContainer&&$(this.buttonsContainer).empty();for(b=0;b<a.length;b++)this.addButton(a[b]);return this};
MultipleItemButtonPanel.prototype.createHTML=function(){var a=0,b,c;if(this.html)return this.html;Element.prototype.createHTML.call(this);this.html.style.position="relative";this.html.style.height="auto";this.html.style.width="auto";this.html.style.display="block";""!==this.label&&(b=this.createHTMLElement("span"),b.className="label",b.appendChild(document.createTextNode(this.label)));c=this.createHTMLElement("div");c.className="container";for(a=0;a<this.buttons.length;a++)c.appendChild(this.getButtonHTML(this.buttons[a]));
this.buttonsContainer=c;b&&this.html.appendChild(b);this.html.appendChild(c);return this.html};var SingleItem=function(a){Element.call(this,a);this.data=this.onEdit=this.inEditMode=this.onChange=this.editable=this.panel=this.showValueTooptip=this.onClick=this.onRemove=this.value=this.label=null;SingleItem.prototype.initObject.call(this,a)};SingleItem.prototype=new Element;SingleItem.prototype.type="SingleItem";SingleItem.prototype.family="SingleItem";
SingleItem.prototype.initObject=function(a){var b={label:"",value:null,showValueTooptip:!0,editable:!1,data:{},onClick:null,onChange:null,onEdit:null,onRemove:function(){}};$.extend(!0,b,a);this.onRemove=b.onRemove;this.onClick=b.onClick;this.onChange=b.onChange;this.inEditMode=!1;this.data="object"===typeof b.data?b.data:{};this.setLabel(b.label).setShowValueToolTip(b.showValueTooptip).setValue(b.value).setIsEditable(b.editable).setOnEditHandler(b.onEdit)};
SingleItem.prototype.setOnEditHandler=function(a){delete this.setOnEditHandler;this.onEdit="function"===typeof a?a:null;this.refreshCursor();return this};SingleItem.prototype.refreshCursor=function(){this.html&&(this.html.style.cursor=this.editable?"pointer":"function"===typeof this.onClick?"pointer":"default");return this};SingleItem.prototype.setIsEditable=function(a){this.editable=!!a;return this.refreshCursor()};SingleItem.prototype.setValue=function(a){this.value=a;return this.updateHTML()};
SingleItem.prototype.getValue=function(){return this.value};SingleItem.prototype.setLabel=function(a){this.label=a;return this.updateHTML()};SingleItem.prototype.getLabel=function(){return this.label};SingleItem.prototype.setData=function(a,b){this.data[a]=b};SingleItem.prototype.getData=function(a){return a?this.data[a]:this.data};SingleItem.prototype.showCloseButton=function(){this.html&&$(this.html).find(".multiple-item-close").css("visibility","visible");return this};
SingleItem.prototype.hideCloseButton=function(){this.html&&$(this.html).find(".multiple-item-close").css("visibility","hidden");return this};SingleItem.prototype.setShowValueToolTip=function(a){"boolean"===typeof a&&(this.showValueTooptip=a);return this};
SingleItem.prototype.updateHTML=function(){this.html&&($(this.html).find("span.label").text(this.getLabel()),this.showValueTooptip&&this.value&&this.html.setAttribute("title",this.value),$(this.html).find(".multiple-item-icon").removeClass().addClass("multiple-item-icon").addClass(this.iconClasses).css("display",this.showIcon?"inline-block":"none"));return this};SingleItem.prototype.edit=function(){};SingleItem.prototype.prepareEditionPanel=function(){};
SingleItem.prototype.exitEditMode=function(){if(!this.inEditMode)return this;this.showCloseButton().panel.close();$(this.html).removeClass("expanded");this.inEditMode=!1;return this};
SingleItem.prototype.onClickHandler=function(){var a=this;return function(b){b.stopPropagation();a.editable?a.inEditMode?a.exitEditMode():(a.panel||(a.panel=new MultipleItemPanel({belongsTo:a.html,width:50})),a.prepareEditionPanel().hideCloseButton().html.parentElement.parentElement.appendChild(a.panel.getHTML()),$(a.html).addClass("expanded"),a.inEditMode=!0,a.panel.open(),"function"===typeof a.onEdit&&a.onEdit.call(a)):"function"===typeof a.onClick&&a.onClick.call(a)}};
SingleItem.prototype.createHTML=function(){if(this.html)return this.html;var a=document.createElement("li"),b=document.createElement("span"),c=this;b.className="label";b.innerHTML=this.getLabel()||"";a.setAttribute("id",this.id);this.showValueTooptip&&this.value&&a.setAttribute("title",this.value);a.appendChild(b);close=document.createElement("a");close.href="javascript: ;";close.className="multiple-item-close";$(close).on("click",function(a){a.stopPropagation();$(c.html).remove();"function"===typeof c.onRemove&&
c.onRemove.call(c)});a.appendChild(close);this.html=a;$(a).on("click",c.onClickHandler());this.refreshCursor();return this.html};SingleItem.prototype.getObject=function(){return{label:this.label,value:this.value}};var ExpressionField=function(a,b){Field.call(this,a,b);this.expressionFieldControl=this.variablesProxy=null;ExpressionField.prototype.initObject.call(this,a)};ExpressionField.prototype=new Field;
ExpressionField.prototype.initObject=function(a){var b={variablesProxy:null};$.extend(!0,b,a);this.setVariablesProxy(b.variablesProxy);this.expressionFieldControl=new ExpressionFieldControl({value:this.value,variables:this.getVariables(),onChange:this.onChangeHandler()})};ExpressionField.prototype.getControl=function(){return this.expressionFieldControl};ExpressionField.prototype.clear=function(){this.expressionFieldControl.clear();return this};
ExpressionField.prototype.onChangeHandler=function(){var a=this;return function(){a.value=this.value;a.onChange()}};ExpressionField.prototype.setVariablesProxy=function(a){a instanceof RestProxy&&(this.variablesProxy=a);return this};ExpressionField.prototype.getValue=function(){return this.value};
ExpressionField.prototype.getVariables=function(){var a,b,c=[];if(this.variablesProxy&&(a=this.variablesProxy.getData())&&a.success)for(b=0;b<a.result.length;b++)c.push({label:a.result[b].text,value:a.result[b].value});return c};
ExpressionField.prototype.isValid=function(){var a=this.expressionFieldControl.isValid();if(a)return $(this.errorTooltip.html).removeClass("adam-tooltip-error-on"),$(this.errorTooltip.html).addClass("adam-tooltip-error-off"),a&&Field.prototype.isValid.call(this);this.errorTooltip.setMessage("invalid criteria syntax");$(this.errorTooltip.html).removeClass("adam-tooltip-error-off");$(this.errorTooltip.html).addClass("adam-tooltip-error-on");return a};
ExpressionField.prototype.createHTML=function(){var a,b="";Field.prototype.createHTML.call(this);this.required&&(b="<i>*</i> ");a=this.createHTMLElement("span");a.className="adam-form-label";a.innerHTML=b+this.label+":";a.style.width=this.parent.labelWidth||"auto";this.html.appendChild(a);this.controlObject=a=this.expressionFieldControl.getHTML();this.html.appendChild(a);this.errorTooltip&&this.html.appendChild(this.errorTooltip.getHTML());this.helpTooltip&&this.html.appendChild(this.helpTooltip.getHTML());
return this.html};ExpressionField.prototype.setValue=function(a){this.value=a;this.expressionFieldControl&&this.expressionFieldControl.setValue(a);return this};ExpressionField.prototype.evalRequired=function(){var a=!0;this.required&&((a=this.expressionFieldControl.items.length)?$(this.controlObject).removeClass("required"):$(this.controlObject).addClass("required"));return a};
var ExpressionFieldControl=function(a){Element.call(this,a);this.items=[];this.expressionContainer=this.onChange=this.value=this.isPanelOpen=this.panel=null;this.variables=[];this.initialized=!1;ExpressionFieldControl.prototype.initObject.call(this,a)};ExpressionFieldControl.prototype=new Element;ExpressionFieldControl.prototype.expressionType={ARITMETIC:0,LOGIC:1,GROUP:2,EVALUATION:3,VAR:4,CONST:5,SQL:6,INT:7,FLOAT:8,STRING:9,BOOL:10,DATE:11};
ExpressionFieldControl.prototype.expressions=[["+","-","x","/"],["AND","OR","NOT"],["(",")"],"==;<;<=;=>;>;<>;within;not within".split(";"),[],["NOW","NULL"]];ExpressionFieldControl.prototype.initObject=function(a){var b={variables:[],value:"[]",onChange:null};$.extend(!0,b,a);this.setVariables(b.variables).setValue(b.value);this.onChange=b.onChange;this.initialized=!0};ExpressionFieldControl.prototype.setVariables=function(a){a.push&&a.pop&&(this.variables=a);return this};
ExpressionFieldControl.prototype.clear=function(){for(;this.items.length;)this.removeItem(this.items[0]);return this};ExpressionFieldControl.prototype.setValue=function(a){var b=this.value;this.value=a;if(this.value===b)return this;this.clear();if("undefined"!==typeof a&&null!==a&&""!==$.trim(a)){a=JSON.parse(this.value);for(b=0;b<a.length;b++)this.addItem(new ExpressionComponent({label:a[b].value,value:label||a[b].value,data:{type:this.expressionType[a[b].type]}}))}return this};
ExpressionFieldControl.prototype.removeItem=function(a){var b;for(b=0;b<this.items.length;b++)if(this.items[b]===a){this.items.splice(b,1);$(this.expressionContainer).find("input").eq(b).remove();$(this.expressionContainer).find("input").eq(b).select();break}this.updateValue();return this};
ExpressionFieldControl.prototype.validateInputValue=function(a){var b=0,c,d;if("undefined"===typeof a||null===a||""===$.trim(a))return{valid:!1};if(/^\s*(\+|-)?\d+\s*$/.test(a))return{valid:!0,type:this.expressionType.INT,value:a};if(/^\s*(\+|-)?\d+\.\d+\s*$/.test(a))return{valid:!0,type:this.expressionType.FLOAT,value:a};if(/^\s*(true|false)\s*$/i.test(a))return{valid:!0,type:this.expressionType.BOOL,value:a.toUpperCase()};if(/^\s*\d{4}-((0\d)|(1[0-2]))-(([0-2]\d)|(3[01]))\s*$/.test(a)){b=a.split("-");
b[0]=parseInt(b[0],10);b[1]=parseInt(b[1],10);b[2]=parseInt(b[2],10);switch(b[1]){case 2:b=b[0]%4&&0!=b[0]%100||0===b[0]%400?!(29<b[2]):!(28<b[2]);break;case 4:case 6:case 9:case 11:b=!(30<b[2]);break;default:b=!(31<b[2])}if(b)return{valid:!0,type:this.expressionType.DATE,value:a,label:a}}else{if(/("(?:[^"\\]|\\.)*")|('(?:[^'\\]|\\.)*')/.test(a))return a=a.substr(1,a.length-2),b='"'+a.replace(/"/g,'\\"').replace(/'/g,"\\'")+'"',{valid:!0,type:this.expressionType.STRING,value:a,label:b};for(c in this.expressionType)if(d=
this.expressionType[c],this.expressions[d])for(b=0;b<this.expressions[d].length;b++)if(a.toLowerCase()==this.expressions[d][b].toLowerCase())return{valid:!0,value:this.expressions[d][b],type:d}}return{valid:!1}};
ExpressionFieldControl.prototype.processInput=function(a){var b,c=$(a.parentElement).find("input").index(a);a.value=$.trim(a.value);b=this.validateInputValue(a.value);return b.valid?($(a).val("").css("width","1px"),this.addItem(new ExpressionComponent({label:b.label||b.value,value:b.value,data:{type:b.type}}),c),!0):!1};
ExpressionFieldControl.prototype.createTextInput=function(){var a=this.createHTMLElement("input");a.type="text";a.style.width="1px";a.style.margin="0px";a.style.padding="0px";a.className="multiple-item-input";return a};ExpressionFieldControl.prototype.dispatchOnChangeCallback=function(a){"function"===typeof this.onChange&&this.initialized&&this.onChange.call(this,this.getValue(),a);return this};
ExpressionFieldControl.prototype.updateValue=function(){var a,b="",c=this.getValue();if(this.html){for(a=0;a<this.items.length;a++)b+=this.items[a].getLabel()+" ";this.html.value=this.html.title=b}this.value=JSON.stringify(this.getObject());this.value!==c&&this.dispatchOnChangeCallback(c);return this};
ExpressionFieldControl.prototype.onItemClickHandler=function(){var a=this;return function(){var b=new MultipleItemPanel({belongsTo:this.getHTML()}),c=a.expressions[this.getData("type")],d,e=[],f=this;for(d=0;d<c.length;d++)e.push({caption:c[d],onClick:function(){$(b.html).remove();delete b;f.setValue(this.name).setLabel(this.name);a.dispatchOnChangeCallback()}});b.setButtons(e);document.body.appendChild(b.getHTML());b.open()}};
ExpressionFieldControl.prototype.addItem=function(a,b){var c=this,d,e;a instanceof ExpressionComponent?a.parent=this:(a.type===this.expressionType.STRING&&(e='"'+a.value.replace(/"/g,'\\"').replace(/'/g,"\\'")+'"'),a=new ExpressionComponent({label:e||a.value,value:a.value,showValueTooltip:!1,data:{type:a.type}},this));a.onChange=function(a,b){c.dispatchOnChangeCallback(b)};a.onEdit=function(){var a;for(a=0;a<c.items.length;a++)c.items[a]!==this&&c.items[a].exitEditMode()};!b&&0!==b&&(d=$(this.expressionContainer).find("input:focus").get(0))&&
(b=$(this.expressionContainer).find("input").index(d));a.onRemove=function(){c.removeItem(this)};"undefined"===typeof b||null===b||b>=this.items.length?(this.items.push(a),this.html&&(this.expressionContainer.appendChild(a.getHTML()),this.expressionContainer.appendChild(this.createTextInput()),$(this.expressionContainer).find("input:last").focus().select())):(this.items.splice(b,0,a),this.html&&(0===b?$(this.expressionContainer).prepend(a.getHTML()).prepend(this.createTextInput()):$(this.expressionContainer).find("li").eq(b).before(a.getHTML()).before(this.createTextInput()),
$(this.expressionContainer).find("input").eq(b+1).focus().select()));d&&(d.value="",d.style.width="1px");this.updateValue();return this};ExpressionFieldControl.prototype.onListItemSelected=function(a){var b=this;return function(c,d){var e=new ExpressionComponent({label:c,value:c,showValueTooltip:!1,data:{type:a}});b.addItem(e)}};
ExpressionFieldControl.prototype.onOperatorClickHandler=function(){var a=this;return function(){a.addItem(new ExpressionComponent({label:this.caption,value:this.caption,showValueTooltip:!1,data:{type:this.value}}))}};
ExpressionFieldControl.prototype.setupPanel=function(){var a,b,c,d;b=[];var e,f,g=[];if(!this.panel){this.panel=new MultipleItemPanel({matchParentWidth:!1,width:24,belongsTo:this.html});$(this.panel.getHTML()).addClass("expression-field-panel");a=this.createHTMLElement("ul");a.className="multiple-item-container";this.expressionContainer=a;this.expressionContainer.appendChild(this.createTextInput());for(f in this.expressionType)if("CONST"!==f&&(e=this.expressionType[f],this.expressions[e]))for(j=0;j<
this.expressions[e].length;j++)b.push({caption:this.expressions[e][j],value:e});for(e=0;e<this.expressions[this.expressionType.CONST].length;e++)g.push({label:this.expressions[this.expressionType.CONST][e],value:this.expressions[this.expressionType.CONST][e]});b=new MultipleItemButtonPanel({label:"",fallbackOnClickHandler:this.onOperatorClickHandler(),buttons:b});c=new MultipleItemListSubpanel({title:"Variables",collapsable:!0,items:this.variables,onItemSelect:this.onListItemSelected(this.expressionType.VAR)});
d=new MultipleItemListSubpanel({title:"Constants",collapsable:!0,items:g,onItemSelect:this.onListItemSelected(this.expressionType.CONST),onOpen:function(){c.close()}});c.onOpen=function(){d.close()};this.panel.getHTML().appendChild(a);this.panel.getHTML().appendChild(b.getHTML());this.panel.getHTML().appendChild(c.getHTML());this.panel.getHTML().appendChild(d.getHTML())}return this};
ExpressionFieldControl.prototype.createHTML=function(){var a;if(this.html)return this.html;a=this.createHTMLElement("input");a.type="text";a.readOnly=!0;this.html=a;this.updateValue();this.setupPanel();for(a=0;a<this.items.length;a++)this.expressionContainer.appendChild(this.items[a].getHTML()),this.expressionContainer.appendChild(this.createTextInput());this.attachListeners();return this.html};ExpressionFieldControl.prototype.selectInput=function(){return this};
ExpressionFieldControl.prototype.openPanel=function(){$(this.panel.html).addClass("focused");$(document.body).append(this.panel.getHTML());this.panel.open();$(this.expressionContainer).trigger("click");$(this.controlObject).addClass("focused");this.isPanelOpen=!0;return this};ExpressionFieldControl.prototype.closePanel=function(){var a;this.panel.close();$(this.controlObject).removeClass("focused");for(a=0;a<this.items.length;a++)this.items[a].exitEditMode();this.isPanelOpen=!1;return this};
ExpressionFieldControl.prototype.updateTextInput=function(a,b){var c=$(a).css("font-family"),d=$(a).css("font-size"),c=this.calculateWidth(b||a.value,d+" "+c);a.style.width=(c||1)+"px";return this};ExpressionFieldControl.prototype.checkExternalClickHandler=function(){var a=this;return function(b){a.isPanelOpen&&(b=$(b.target),b[0].id!==a.panel.html.id&&0===b.parents("#"+a.panel.html.id).length&&a.closePanel())}};
ExpressionFieldControl.prototype.attachListeners=function(){var a=this;if(!this.html)return this;$(this.html).on("focus",function(){$(this).addClass("focused");a.selectInput().openPanel()}).on("keydown click",function(b){27===b.which||9===b.which?a.closePanel():a.openPanel()});$(this.expressionContainer).on("click",function(a){$(this).find("input:last").select()}).on("keydown",".multiple-item-input",function(b){13===b.which?a.processInput(this)||this.select():37===b.which&&""===this.value?(b.preventDefault(),
$(this).prev().prev().select()):39===b.which&&""===this.value?(b.preventDefault(),$(this).next().next().select()):27===b.which&&($(a.controlObject).focus(),a.closePanel())}).on("keypress",".multiple-item-input",function(b){a.updateTextInput(this,this.value+String.fromCharCode(b.which))}).on("keyup",".multiple-item-input",function(b){a.updateTextInput(this)}).on("blur",".multiple-item-input",function(b){a.processInput(this)||(this.value="",this.style.width="1px")}).on("click",".multiple-item-input",
function(a){a.stopPropagation()});$(this.html.parentElement).on("scroll",function(){a.closePanel()});$(document).on("mousedown",this.checkExternalClickHandler());return this};
ExpressionFieldControl.prototype.isValid=function(){var a=!0,b=0,c=null,d;for(d=0;d<this.items.length;d++){if(0===d)switch(this.items[d].getData("type")){case this.expressionType.ARITMETIC:a=!1;break;case this.expressionType.GROUP:a="("===this.items[d].getValue();b++;break;case this.expressionType.LOGIC:a="NOT"===this.items[d].getValue();break;case this.expressionType.EVALUATION:a=!1;break;case this.expressionType.CONST:case this.expressionType.INT:case this.expressionType.FLOAT:case this.expressionType.BOOL:case this.expressionType.STRING:case this.expressionType.DATE:case this.expressionType.VAR:a=
!0}else switch(this.items[d].getData("type")){case this.expressionType.ARITMETIC:case this.expressionType.EVALUATION:c.type!==this.expressionType.ARITMETIC&&(c.type!==this.expressionType.GROUP||"("!==c.value)&&c.type!==this.expressionType.LOGIC&&c.type!==this.expressionType.EVALUATION||(a=!1);break;case this.expressionType.GROUP:"("===this.items[d].getValue()?(b++,null===c?a=!0:c.type!==this.expressionType.CONST&&c.type!==this.expressionType.VAR&&(c.type!==this.expressionType.GROUP||")"!==c.value)&&
c.type!==this.expressionType.INT&&c.type!==this.expressionType.FLOAT&&c.type!==this.expressionType.BOOL&&c.type!==this.expressionType.DATE&&c.type!==this.expressionType.STRING||(a=!1)):(b--,c.type!==this.expressionType.ARITMETIC&&(c.type!==this.expressionType.GROUP||"("!==c.value)&&c.type!==this.expressionType.LOGIC&&c.type!==this.expressionType.EVALUATION||(a=!1));break;case this.expressionType.LOGIC:if("NOT"===this.items[d].getValue())if(null===c)a=!0;else{if(c.type===this.expressionType.LOGIC&&
"NOT"===c.value||c.type===this.expressionType.GROUP&&")"===c.value)a=!1}else c.type!==this.expressionType.ARITMETIC&&(c.type!==this.expressionType.GROUP||"("!=c.value)&&c.type!==this.expressionType.LOGIC&&c.type!==this.expressionType.EVALUATION||(a=!1);break;case this.expressionType.CONST:case this.expressionType.INT:case this.expressionType.FLOAT:case this.expressionType.BOOL:case this.expressionType.STRING:case this.expressionType.DATE:case this.expressionType.VAR:if(null===c)a=!0;else if(!(c.type!==
this.expressionType.GROUP||")"!==c.value)||!(c.type!==this.expressionType.CONST&&c.type!==this.expressionType.VAR&&c.type!==this.expressionType.INT&&c.type!==this.expressionType.FLOAT&&c.type!==this.expressionType.BOOL&&c.type!==this.expressionType.STRING&&c.type!==this.expressionType.DATE))a=!1}if(d===this.items.length-1&&a)switch(this.items[d].getData("type")){case this.expressionType.ARITMETIC:a=!1;break;case this.expressionType.GROUP:a=")"===this.items[d].getValue();break;case this.expressionType.LOGIC:a=
!1;break;case this.expressionType.EVALUATION:a=!1;break;case this.expressionType.CONST:case this.expressionType.INT:case this.expressionType.FLOAT:case this.expressionType.BOOL:case this.expressionType.STRING:case this.expressionType.DATE:case this.expressionType.VAR:a=!0}if(!a)break;c={type:this.items[d].getData("type"),value:this.items[d].getValue()}}return a&&0===b};ExpressionFieldControl.prototype.getValue=function(){return this.value};
ExpressionFieldControl.prototype.getObject=function(){var a=[],b,c=[];for(b in this.expressionType)c[this.expressionType[b]]=b;for(b=0;b<this.items.length;b++)a.push({value:this.items[b].getValue(),type:c[this.items[b].getData("type")]});return a};ExpressionFieldControl.prototype.remove=function(){$(this.html).remove();this.panel.remove();$(this.expressionContainer).remove();delete this.items;delete this.isPanelOpen;delete this.value;delete this.onChange;delete this.variables};
var ExpressionComponent=function(a,b){SingleItem.call(this,$.extend(!0,{editable:!0},a));this.parent=b;this.onChange=a.onChange||null};ExpressionComponent.prototype=new SingleItem;
ExpressionComponent.prototype.prepareEditionPanel=function(){var a,b=this.getData("type"),c=this;this.panel.clear();if(b===ExpressionFieldControl.prototype.expressionType.VAR)this.panel.addSubpanel({title:"Variables",items:this.parent.variables,visibleHeader:!1,onItemSelect:function(a){c.setValue(a);c.setLabel(a);c.parent.updateValue();c.exitEditMode()}},"list"),this.panel.matchParentWidth=!1;else if(b<=ExpressionFieldControl.prototype.expressionType.INT&&ExpressionFieldControl.prototype.expressions[b])for(a=
0;a<ExpressionFieldControl.prototype.expressions[b].length;a++)ExpressionFieldControl.prototype.expressions[b][a]!==this.getValue()&&this.panel.addButton({caption:ExpressionFieldControl.prototype.expressions[b][a],data:{value:ExpressionFieldControl.prototype.expressions[b][a]},onClick:function(){c.setValue(this.data.value);c.setLabel(c.getValue());c.parent.updateValue();c.exitEditMode()}});$(this.panel.getHTML()).css("width","150px");return this};
var DecisionTableVariable=function(a){Element.call(this);this.onChangeValue=this.onChange=this.onRemove=this.closeButton=this.select=this.returnType=this.mode=this.parent=this.value=this.name=this.values=null;this.fields=[];this.behavior=null;DecisionTableVariable.prototype.initObject.call(this,a)};DecisionTableVariable.prototype=new Element;DecisionTableVariable.prototype.type="DecisionTableVariable";
DecisionTableVariable.prototype.initObject=function(a){var b={values:[],name:null,value:null,parent:null,mode:"condition",returnType:!1,onRemove:null,onChange:null,onChangeValue:null,behavior:"set",fields:[]};$.extend(!0,b,a);this.value=b.value;this.values=[];this.parent=b.parent;this.mode=b.mode;this.onRemove=b.onRemove;this.onChange=b.onChange;this.onChangeValue=b.onChangeValue;this.returnType=b.returnType;this.setFields(b.fields).setValues(b.values).setName(b.name).setBehavior(b.behavior);this.returnType||
(this.select=new EasySelector({width:"100%",configurable:"condition"!==this.mode,settingOptions:[{label:"set",value:"set"},{label:"array",value:"array"},{label:"concat",value:"concat"}],settingValue:b.behavior,onSettingValueChange:this.onChangeBehaviorHandler(),onChange:this.onSelectChangeHandler()}),this.updateSelect())};
DecisionTableVariable.prototype.onSelectChangeHandler=function(){var a=this;return function(){var b=a.value;a.name=this.getLabel()||null;a.value=this.getValue()||null;$(this.getHTML()).attr("title",a.name).parent().removeClass("error");"function"===typeof a.onChange&&a.onChange.call(a,a.value,b)}};DecisionTableVariable.prototype.onChangeBehaviorHandler=function(){var a=this;return function(b){a.behavior=b}};
DecisionTableVariable.prototype.setBehavior=function(a){this.behavior=a;this.select&&this.select.setSettingValue(a);return this};
DecisionTableVariable.prototype.updateSelect=function(){var a=0;this.select.setOptions([]);if(this.fields.length)for(a=0;a<this.fields.length;a++)this.select.addOption(this.fields[a].label,this.fields[a].value),this.value===this.fields[a].value&&this.select.setSelectedItem(this.fields[a].label,this.fields[a].value);this.behavior&&this.select.setSettingValue(this.behavior);return this};
DecisionTableVariable.prototype.setFields=function(a){a.push&&a.pop&&(this.fields=a,this.select&&this.updateSelect());return this};DecisionTableVariable.prototype.setName=function(a){this.name=a;return this};
DecisionTableVariable.prototype.setValues=function(a){if("object"!=typeof a||!a.push)return this;var b=0;if("conclusion"===this.mode)for(b=0;b<a.length;b++)("string"===typeof a[b]||"number"===typeof a[b])&&this.values.push(new DecisionTableSingleValue({value:a[b],parent:this,fields:this.fields}));else for(b=0;b<a.length;b++)this.values.push(new DecisionTableValueEvaluation({value:a[b].value,operator:a[b].operator,parent:this,fields:this.fields}));return this};
DecisionTableVariable.prototype.getValueHTML=function(a){return this.values[a]?this.values[a].getHTML():null};
DecisionTableVariable.prototype.createHTML=function(){if(this.html)return this.html;var a=this.createHTMLElement("th"),b;this.returnType?(b=this.createHTMLElement("span"),b.className="decision-table-return",b.appendChild(document.createTextNode(this.returnType?"Return":this.name||""))):b=this.select.getHTML();a.appendChild(b);this.returnType||(b=this.createHTMLElement("button"),b.appendChild(document.createTextNode(" ")),b.className="decision-table-close-button",b.title="Remove Column",this.closeButton=
b,a.appendChild(this.closeButton));this.html=a;this.attachListeners();return a};DecisionTableVariable.prototype.remove=function(){if(!this.getFilledValuesNum()||confirm("Do you really want to remove this variable?")){for(;this.values.length;)this.values[0].remove();this.values=null;$(this.html).remove();"function"===typeof this.onRemove&&this.onRemove.call(this)}};
DecisionTableVariable.prototype.attachListeners=function(){var a=this;if(!this.html)return this;$(this.closeButton).on("click",function(){a.remove()});return this};DecisionTableVariable.prototype.getFilledValuesNum=function(){var a,b=0;for(a=0;a<this.values.length;a++)this.values[a].filledValue()&&b++;return b};DecisionTableVariable.prototype.onRemoveValueHandler=function(){var a=this;return function(){var b;for(b=0;b<a.values.length;b++)if(a.values[b]===this){a.values.splice(b,1);break}}};
DecisionTableVariable.prototype.onChangeValueHandler=function(){var a=this;return function(b,c){"function"===typeof a.onChangeValue&&a.onChangeValue.call(a,this,b,c)}};
DecisionTableVariable.prototype.addValue=function(a,b){a="conclusion"===this.mode?new DecisionTableSingleValue({value:a,parent:this,fields:this.fields}):new DecisionTableValueEvaluation({value:a,operator:b,parent:this,fields:this.fields});a.onRemove=this.onRemoveValueHandler();a.onChange=this.onChangeValueHandler();this.values.push(a);return this};
DecisionTableVariable.prototype.getJSON=function(a){var b={};if("number"===typeof a){if(this.values[a]){b.value=this.values[a].getValue();if("conclusion"===this.mode)b.conclusion_value=this.returnType?"result":this.select.value,b.conclusion_type=this.returnType?"return":"variable";else if(b.variable_name=this.select.value,b.condition=this.values[a].operator,b.value&&!b.condition||!b.value&&!b.condition)return!1;return b}}else return!1};
DecisionTableVariable.prototype.removeValue=function(a){this.values[a]&&($(this.values[a].getHTML()).remove(),this.values.splice(a,1));return this};
DecisionTableVariable.prototype.isValid=function(){var a={valid:!0},b,c=0,d;this.select&&$(this.select.getHTML()).parent().removeClass("error");if("conclusion"===this.mode)for(b=0;b<this.values.length;b++){d=this.values[b].isValid();if(!d.valid)return d;this.values[b].value.length&&c++}else for(b=0;b<this.values.length;b++)if(d=this.values[b].isValid(),this.values[b].operator&&c++,!d.valid)return a.valid=!1,a.message=d.message,a.index=b,a;c&&(this.select&&!this.select.value)&&($(this.select.getHTML().parentElement).addClass("error"),
a={valid:!1,message:"Any variable wasn't selected"});return a};var DecisionTableValue=function(a){Element.call(this);this.parent=this.onChange=this.onRemove=this.expression=this.value=null;DecisionTableValue.prototype.initObject.call(this,a)};DecisionTableValue.prototype=new Element;DecisionTableValue.prototype.type="DecisionTableValue";
DecisionTableValue.prototype.initObject=function(a){var b={value:[],onRemove:null,onChange:null,parent:null,fields:[]};$.extend(!0,b,a||{});this.parentElement=b.parent;this.expression=new ExpressionFieldControl({variables:b.fields,onChange:this.onChangeExpressionHandler()},this);this.setValue(b.value);this.onRemove=b.onRemove;this.onChange=b.onChange};
DecisionTableValue.prototype.onChangeExpressionHandler=function(){var a=this;return function(b,c){a.value=this.getObject();"function"===typeof a.onChange&&a.onChange.call(a,b,c)}};DecisionTableValue.prototype.updateHTML=function(){};DecisionTableValue.prototype.setValue=function(a){var b;this.expression.clear();for(b=0;b<a.length;b++)this.expression.addItem({value:a[b].value,label:a[b].value,type:ExpressionFieldControl.prototype.expressionType[a[b].type]});this.value=a;this.updateHTML();return this};
DecisionTableValue.prototype.createHTML=function(){};DecisionTableValue.prototype.onEnterCellHandler=function(a){return function(){if("function"===typeof a){var b=a();$(this.parentElement).empty().append(b);$(b).select().focus()}}};
DecisionTableValue.prototype.onLeaveCellHandler=function(a){var b=this;return function(){var c=document.createElement("span"),d=this.parentElement,e=b[a],f=!1;c.tabIndex=0;f=e!==this.value;b[a]=this.value;b[a]?c.appendChild(document.createTextNode(b[a])):c.innerHTML="&nbsp;";try{$(d).empty().append(c)}catch(g){}b.isValid();f&&"function"===typeof b.onChange&&b.onChange.call(b,b[a],e)}};
DecisionTableValue.prototype.isValid=function(){if(this.expression.isValid())return $(this.html).removeClass("error"),{valid:!0};$(this.html).addClass("error");return{valid:!1,message:"Invalid expression"}};DecisionTableValue.prototype.attachListeners=function(){};DecisionTableValue.prototype.remove=function(){$(this.html).remove();this.expression.remove();"function"===typeof this.onRemove&&this.onRemove.call(this)};DecisionTableValue.prototype.getValue=function(){return this.expression.getObject()};
DecisionTableValue.prototype.filledValue=function(){return!!this.value.length};var DecisionTableSingleValue=function(a){DecisionTableValue.call(this,a)};DecisionTableSingleValue.prototype=new DecisionTableValue;DecisionTableSingleValue.prototype.type="DecisionTableSingleValue";DecisionTableSingleValue.prototype.createValueControl=function(){var a=this;return function(){var b=document.createElement("input");b.type="text";b.value=a.value||"";return b}};
DecisionTableSingleValue.prototype.updateHTML=function(){this.html&&(this.value?$(this.html).find("span").text(this.value):$(this.html).find("span").html("&nbsp;"),$(this.html).find("input").val(this.value));return this};DecisionTableSingleValue.prototype.createHTML=function(){if(this.html)return this.html;var a;a=this.createHTMLElement("td");a.appendChild(this.expression.getHTML());return this.html=a};
var DecisionTableValueEvaluation=function(a){DecisionTableValue.call(this,a);this.operator=null;DecisionTableValueEvaluation.prototype.initObject.call(this,a)};DecisionTableValueEvaluation.prototype=new DecisionTableValue;DecisionTableValueEvaluation.prototype.OPERATORS="=;>=;<=;>;<;!=;<>;within;not within".split(";");DecisionTableValueEvaluation.prototype.initObject=function(a){this.setOperator(a.operator||"")};DecisionTableValueEvaluation.prototype.setOperator=function(a){this.operator=a;return this};
DecisionTableValueEvaluation.prototype.createHTML=function(){if(this.html)return this.html;var a,b,c;a=DecisionTableSingleValue.prototype.createHTML.call(this);b=this.createHTMLElement("td");b.className="decision-table-operator";c=this.createHTMLElement("span");c.tabIndex=0;this.operator?c.appendChild(document.createTextNode(this.operator)):c.innerHTML="&nbsp";b.appendChild(c);this.html=[b,a];this.attachListeners();return this.html};
DecisionTableValueEvaluation.prototype.fillOperators=function(a){var b,c;$(a).append("<option></option>");for(b=0;b<this.OPERATORS.length;b++)c=this.createHTMLElement("option"),c.label=c.value=this.OPERATORS[b],c.appendChild(document.createTextNode(this.OPERATORS[b])),c.selected=this.OPERATORS[b]===this.operator,a.appendChild(c);return a};
DecisionTableValueEvaluation.prototype.createValueControl=function(){var a=this;return function(){var b=document.createElement("input");b.type="text";b.value=a.value||"";return b}};DecisionTableValueEvaluation.prototype.createOperatorControl=function(){var a=this;return function(){var b=document.createElement("select");a.fillOperators(b);b.value=a.operator;return b}};
DecisionTableValueEvaluation.prototype.attachListeners=function(){if(!this.html||!this.html.push)return this;$(this.html[0]).on("focus","span",this.onEnterCellHandler(this.createOperatorControl())).on("blur","select",this.onLeaveCellHandler("operator"));return this};DecisionTableValueEvaluation.prototype.filledValue=function(){return!!this.operator&&DecisionTableValue.prototype.filledValue.call(this)};
DecisionTableValueEvaluation.prototype.isValid=function(){var a=DecisionTableValue.prototype.isValid.call(this);a.valid?(a={valid:!!this.value.length===!!this.operator},a.valid?$(this.html).removeClass("error"):($(this.html).addClass("error"),a.message="missing expression or operator")):$(this.html[0]).removeClass("error");return a};DecisionTableValueEvaluation.prototype.getOperator=function(){return this.operator};
(function(a){a.fn.BRControl=function(b){var c,d=a(this);b.width=d.width()||"auto";c=new DecisionTable(b);d.html(c.getHTML());c.onChange=function(){if(b&&b.onChange)b.onChange(c.getJSON())};c.onAddColumn=function(){if(b&&b.onAddColumn)b.onAddColumn(c.getJSON())};c.onRemoveColumn=function(){if(b&&b.onRemoveColumn)b.onRemoveColumn(c.getJSON())};return{getJSON:function(){return c.getJSON()},isValid:function(){return c.isValid()}}}})(jQuery);

<Schema name="processmaker">
	<Cube name="cubo" cache="true" enabled="true">
		<Table name="APP_CACHE_VIEW">
		</Table>
		
		<Dimension foreignKey="APP_PRO_TITLE" name="Process">
			<Hierarchy hasAll="true" allMemberName="All Processes" primaryKey="APP_PRO_TITLE">
				<Level name="Processes" column="APP_PRO_TITLE" type="String" uniqueMembers="true" levelType="Regular" hideMemberIf="Never">
				</Level>
			</Hierarchy>
		</Dimension>
		
		<Dimension foreignKey="APP_UID" name="Routing">
			<Hierarchy hasAll="true" allMemberName="All Routings" primaryKey="APP_UID">
				<Level name="Routings" column="APP_UID" type="String" uniqueMembers="true" levelType="Regular" hideMemberIf="Never">
				</Level>
			</Hierarchy>
		</Dimension>
		
		<Dimension foreignKey="APP_TAS_TITLE" name="Task">
			<Hierarchy hasAll="true" allMemberName="All Tasks" primaryKey="APP_TAS_TITLE">
				<Level name="Tasks" column="APP_TAS_TITLE" type="String" uniqueMembers="true" levelType="Regular" hideMemberIf="Never">
				</Level>
			</Hierarchy>
		</Dimension>
		
		<Dimension foreignKey="APP_STATUS" name="Case Status">
			<Hierarchy hasAll="true" allMemberName="All Case Status" primaryKey="APP_STATUS">
				<Level name="Status" column="APP_STATUS" type="String" uniqueMembers="true" levelType="Regular" hideMemberIf="Never">
				</Level>
			</Hierarchy>
		</Dimension>
		
		<Dimension foreignKey="DEL_THREAD_STATUS" name="Routing Status">
			<Hierarchy hasAll="true" allMemberName="All Routing Status" primaryKey="DEL_THREAD_STATUS">
				<Level name="Status" column="DEL_THREAD_STATUS" type="String" uniqueMembers="true" levelType="Regular" hideMemberIf="Never">
				</Level>
			</Hierarchy>
		</Dimension>
		
		<Dimension foreignKey="APP_CURRENT_USER" name="Current User">
			<Hierarchy hasAll="true" allMemberName="All Users" primaryKey="APP_CURRENT_USER">
				<Level name="Users" column="APP_CURRENT_USER" type="String" uniqueMembers="true" levelType="Regular" hideMemberIf="Never">
				</Level>
			</Hierarchy>
		</Dimension>
		
		<Dimension foreignKey="USR_UID" name="Current User Id">
			<Hierarchy hasAll="true" allMemberName="All Users Ids" primaryKey="USR_UID">
				<Level name="Users Ids" column="USR_UID" type="String" uniqueMembers="true" levelType="Regular" hideMemberIf="Never">
				</Level>
			</Hierarchy>
		</Dimension>
		
		<Dimension type="TimeDimension" foreignKey="DEL_DELEGATE_DATE" name="Routing Delegate Date">
			<Hierarchy hasAll="true" allMemberName="All" primaryKey="TIME_ID">
				<Table name="DIM_TIME_DELEGATE">
				</Table>
				<Level name="Years" column="YEAR_ID" type="String" uniqueMembers="true" levelType="TimeYears" hideMemberIf="Never">
				</Level>
				<Level name="Quarters" column="QTR_NAME" ordinalColumn="QTR_ID" type="String" uniqueMembers="false" levelType="TimeQuarters" hideMemberIf="Never">
				</Level>
				<Level name="Months" column="MONTH_NAME" ordinalColumn="MONTH_ID" type="String" uniqueMembers="false" levelType="TimeMonths" hideMemberIf="Never">
				</Level>
			</Hierarchy>
		</Dimension>
		
		<Dimension type="TimeDimension" foreignKey="DEL_FINISH_DATE" name="Routing Complete Date">
			<Hierarchy hasAll="true" allMemberName="All" primaryKey="TIME_ID">
				<Table name="DIM_TIME_COMPLETE">
				</Table>
				<Level name="Years" column="YEAR_ID" type="String" uniqueMembers="true" levelType="TimeYears" hideMemberIf="Never">
				</Level>
				<Level name="Quarters" column="QTR_NAME" ordinalColumn="QTR_ID" type="String" uniqueMembers="false" levelType="TimeQuarters" hideMemberIf="Never">
				</Level>
				<Level name="Months" column="MONTH_NAME" ordinalColumn="MONTH_ID" type="String" uniqueMembers="false" levelType="TimeMonths" hideMemberIf="Never">
				</Level>
			</Hierarchy>
		</Dimension>
		
		<Measure name="Cases" column="APP_UID" formatString="####" aggregator="distinct-count">
		</Measure>

		<Measure name="Open Cases" formatString="####" aggregator="sum">
			<MeasureExpression>
				<SQL dialect="generic">
					(case when APP_CACHE_VIEW.DEL_INDEX = 1 and APP_CACHE_VIEW.APP_STATUS != "COMPLETED" then 1 else 0 end)				</SQL>
			</MeasureExpression>
		</Measure>
		
		<Measure name="Completed Cases" formatString="####" aggregator="sum">
			<MeasureExpression>
				<SQL dialect="generic">
					(case when APP_CACHE_VIEW.DEL_INDEX = 1 and APP_CACHE_VIEW.APP_STATUS = "COMPLETED" then 1 else 0 end)				</SQL>
			</MeasureExpression>
		</Measure>

		<Measure name="Routings" column="DEL_INDEX" formatString="####" aggregator="count">
		</Measure>
		
		<Measure name="Closed Routings" column="DEL_FINISHED" formatString="####" aggregator="sum">
		</Measure>

		<Measure name="Open Routings" formatString="####" aggregator="sum">
			<MeasureExpression>
				<SQL dialect="generic">
					(case when APP_CACHE_VIEW.DEL_FINISHED = 0  then 1 else 0 end)				</SQL>
			</MeasureExpression>
		</Measure>

		<Measure name="Overdue Routings" formatString="####" aggregator="sum">
			<MeasureExpression>
				<SQL dialect="generic">
					(case when APP_CACHE_VIEW.DEL_FINISHED = 0 and APP_CACHE_VIEW.DEL_DELAYED = 1 then 1 else 0 end)				</SQL>
			</MeasureExpression>
		</Measure>
		
		<Measure name="Duration" column="DEL_DURATION" formatString="###.##" aggregator="sum">
		</Measure>
		
		<Measure name="Queue Duration" column="DEL_QUEUE_DURATION" formatString="###.##" aggregator="sum">
		</Measure>
		
		<Measure name="Overdue Duration" formatString="###.##" aggregator="sum">
			<MeasureExpression>
				<SQL dialect="generic">
					(case when APP_CACHE_VIEW.DEL_FINISHED = 0 and APP_CACHE_VIEW.DEL_DELAYED = 1 and APP_CACHE_VIEW.DEL_DELAY_DURATION > 0 then APP_CACHE_VIEW.DEL_DELAY_DURATION else 0 end)				</SQL>
			</MeasureExpression>
		</Measure>
		<Measure name="Overdue Percentage" formatString="#.##%" aggregator="avg">
			<MeasureExpression>
				<SQL dialect="generic">
					(case when APP_CACHE_VIEW.DEL_FINISHED = 0 and APP_CACHE_VIEW.DEL_DELAYED = 1 then APP_CACHE_VIEW.APP_OVERDUE_PERCENTAGE else 0 end)				</SQL>
			</MeasureExpression>
		</Measure>

		<Measure name="Green Routings" formatString="####" aggregator="sum">
			<MeasureExpression>
				<SQL dialect="generic">
					(case when APP_CACHE_VIEW.DEL_FINISHED = 0 and APP_CACHE_VIEW.APP_OVERDUE_PERCENTAGE &lt; -0.85 then 1 else 0 end)				</SQL>
			</MeasureExpression>
		</Measure>

		<Measure name="Yellow Routings" formatString="####" aggregator="sum">
			<MeasureExpression>
				<SQL dialect="generic">
					(case when APP_CACHE_VIEW.DEL_FINISHED = 0 and APP_CACHE_VIEW.APP_OVERDUE_PERCENTAGE >= -0.85 and APP_CACHE_VIEW.APP_OVERDUE_PERCENTAGE &lt; 0 then 1 else 0 end)				</SQL>
			</MeasureExpression>
		</Measure>

		<CalculatedMember name="Variance Cases" caption="" formula="([Measures].[Routings]/[Measures].[Cases])" dimension="Measures" formatString="###.##">
		</CalculatedMember>
		
	</Cube>
</Schema>
